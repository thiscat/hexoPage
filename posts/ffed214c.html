<!DOCTYPE html>
<html lang="zh-CN" color-mode="light">

  <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="keywords" content="" />
  <meta name="author" content="cat" />
  <meta name="description" content="" />
  
  
  <title>
    
      mysql配置文件 
      
      
      |
    
     个人资料站
  </title>

  
    <link rel="apple-touch-icon" href="/images/logo.png">
    <link rel="icon" href="/images/logo.png">
  

  <!-- Raleway-Font -->
  <link href="https://fonts.googleapis.com/css?family=Raleway&display=swap" rel="stylesheet">

  <!-- hexo site css -->
  
<link rel="stylesheet" href="/css/color-scheme.css">
<link rel="stylesheet" href="/css/base.css">
<link rel="stylesheet" href="//at.alicdn.com/t/font_1886449_67xjft27j1l.css">
<link rel="stylesheet" href="/css/github-markdown.css">
<link rel="stylesheet" href="/css/highlight.css">
<link rel="stylesheet" href="/css/comments.css">

  <!-- 代码块风格 -->
  
    
<link rel="stylesheet" href="/css/figcaption/mac-block.css">

  

  <!-- jquery3.3.1 -->
  
    <script defer type="text/javascript" src="/plugins/jquery.min.js"></script>
  

  <!-- fancybox -->
  
    <link href="/plugins/jquery.fancybox.min.css" rel="stylesheet">
    <script defer type="text/javascript" src="/plugins/jquery.fancybox.min.js"></script>
  
  
<script src="/js/fancybox.js"></script>


  

  <script>
    var html = document.documentElement
    const colorMode = localStorage.getItem('color-mode')
    if (colorMode) {
      document.documentElement.setAttribute('color-mode', colorMode)
    }
  </script>
<meta name="generator" content="Hexo 5.4.2"></head>


  <body>
    <div id="app">
      <div class="header">
  <div class="avatar">
    <a href="/">
      <!-- 头像取消懒加载，添加no-lazy -->
      
        <img src="/images/logo.png" alt="">
      
    </a>
    <div class="nickname"><a href="/">cat</a></div>
  </div>
  <div class="navbar">
    <ul>
      
        <li class="nav-item" data-path="/">
          <a href="/">Home</a>
        </li>
      
        <li class="nav-item" data-path="/archives/">
          <a href="/archives/">Archives</a>
        </li>
      
        <li class="nav-item" data-path="/categories/">
          <a href="/categories/">Categories</a>
        </li>
      
        <li class="nav-item" data-path="/tags/">
          <a href="/tags/">Tags</a>
        </li>
      
    </ul>
  </div>
</div>


<script src="/js/activeNav.js"></script>



      <div class="flex-container">
        <!-- 文章详情页，展示文章具体内容，url形式：https://yoursite/文章标题/ -->
<!-- 同时为「标签tag」，「朋友friend」，「分类categories」，「关于about」页面的承载页面，具体展示取决于page.type -->


  <!-- LaTex Display -->

  
    <script async type="text/javascript" src="/plugins/mathjax/tex-chtml.js"></script>
  
  <script>
    MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']]
      }
    }
  </script>





  <!-- clipboard -->

  
    <script async type="text/javascript" src="/plugins/clipboard.min.js"></script>
  
  
<script src="/js/codeCopy.js"></script>







  

  

  

  
  <!-- 文章内容页 url形式：https://yoursite/文章标题/ -->
  <div class="container post-details" id="post-details">
    <div class="post-content">
      <div class="post-title">mysql配置文件</div>
      <div class="post-attach">
        <span class="post-pubtime">
          <i class="iconfont icon-updatetime" title="更新时间"></i>
          2017-11-07 01:56:27
        </span>
        
              <span class="post-categories">
                <i class="iconfont icon-bookmark" title="分类"></i>
                
                <span class="span--category">
                  <a href="/categories/%E5%90%8E%E7%AB%AF/" title="后端">
                    <b>#</b> 后端
                  </a>
                </span>
                
                <span class="span--category">
                  <a href="/categories/%E5%90%8E%E7%AB%AF/mysql/" title="mysql">
                    <b>#</b> mysql
                  </a>
                </span>
                
              </span>
          
              <span class="post-tags">
                <i class="iconfont icon-tags" title="标签"></i>
                
                <span class="span--tag">
                  <a href="/tags/%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6/" title="配置文件">
                    <b>#</b> 配置文件
                  </a>
                </span>
                
              </span>
          
      </div>
      <div class="markdown-body">
        <p>&lt;Excerpt in index | 首页摘要&gt;</p>
<span id="more"></span>
<p>&lt;The rest of contents | 余下全文&gt;</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># For advice on how to change settings please see</span></span><br><span class="line"><span class="comment"># http://dev.mysql.com/doc/refman/5.6/en/server-configuration-defaults.html</span></span><br><span class="line"></span><br><span class="line"><span class="section">[mysqld]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Remove leading # and set to the amount of RAM for the most important data</span></span><br><span class="line"><span class="comment"># cache in MySQL. Start at 70% of total RAM for dedicated server, else 10%.</span></span><br><span class="line"><span class="comment"># innodb_buffer_pool_size = 128M</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Remove leading # to turn on a very important data integrity option: logging</span></span><br><span class="line"><span class="comment"># changes to the binary log between backups.</span></span><br><span class="line"><span class="comment"># log_bin</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># These are commonly set, remove the # and set as required.</span></span><br><span class="line"><span class="comment"># basedir = .....</span></span><br><span class="line"><span class="comment"># datadir = .....</span></span><br><span class="line"><span class="comment"># port = .....</span></span><br><span class="line"><span class="comment"># server_id = .....</span></span><br><span class="line"><span class="comment"># socket = .....</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Remove leading # to set options mainly useful for reporting servers.</span></span><br><span class="line"><span class="comment"># The server defaults are faster for transactions and fast SELECTs.</span></span><br><span class="line"><span class="comment"># Adjust sizes as needed, experiment to find the optimal values.</span></span><br><span class="line"><span class="comment"># join_buffer_size = 128M</span></span><br><span class="line"><span class="comment"># sort_buffer_size = 2M</span></span><br><span class="line"><span class="comment"># read_rnd_buffer_size = 2M </span></span><br><span class="line"></span><br><span class="line"><span class="attr">user</span> = mysql</span><br><span class="line"><span class="attr">sql_mode</span>=NO_ENGINE_SUBSTITUTION,STRICT_TRANS_TABLES </span><br><span class="line"><span class="attr">basedir</span> = /usr/local/webserver/mysql</span><br><span class="line"><span class="attr">datadir</span> = /data/mysql/data</span><br><span class="line"><span class="attr">port</span> = <span class="number">3306</span></span><br><span class="line"><span class="attr">socket</span> = /tmp/mysql.sock</span><br><span class="line"><span class="comment"># pid_file = /var/run/mysqld.pid</span></span><br><span class="line"><span class="attr">pid_file</span> = /data/mysql/data/mysql.pid</span><br><span class="line"><span class="attr">log-error</span> = /data/mysql/mysqld_error.log</span><br><span class="line"><span class="attr">log-bin</span> = /data/mysql/mysql-bin</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查询超过多少秒写入慢日志</span></span><br><span class="line"><span class="attr">long_query_time</span>=<span class="number">1</span></span><br><span class="line"><span class="comment"># 开启记录慢日志</span></span><br><span class="line"><span class="attr">slow_query_log</span>=<span class="number">1</span></span><br><span class="line"><span class="attr">slow_query_log_file</span>=/data/mysql/mysql-slow.log</span><br><span class="line"><span class="comment"># 　运行的SQL没有使用索引，记录到慢日志 1-开启 0-关闭</span></span><br><span class="line"><span class="attr">log_queries_not_using_indexes</span> = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="attr">max_connections</span>=<span class="number">1000</span></span><br><span class="line"><span class="attr">max_allowed_packet</span>=<span class="number">32</span>M</span><br><span class="line"></span><br><span class="line"><span class="attr">innodb_file_per_table</span> = <span class="number">1</span></span><br><span class="line"><span class="attr">innodb_buffer_pool_size</span> = <span class="number">1</span>G</span><br><span class="line"></span><br><span class="line"><span class="comment"># 0：log buffer将每秒一次地写入log file中，并且log file的flush(刷到磁盘)操作同时进行。该模式下在事务提交的时候，不会主动触发写入磁盘的操作。</span></span><br><span class="line"><span class="comment"># 1：每次事务提交时MySQL都会把log buffer的数据写入log file，并且flush(刷到磁盘)中去，该模式为系统默认。</span></span><br><span class="line"><span class="comment"># 2：每次事务提交时MySQL都会把log buffer的数据写入log file，但是flush(刷到磁盘)操作并不会同时进行。该模式下，MySQL会每秒执行一次 flush(刷到磁盘)操作。</span></span><br><span class="line"><span class="attr">innodb_flush_log_at_trx_commit</span> = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="attr">sql_mode</span>=<span class="string">&quot;&quot;</span></span><br><span class="line"><span class="comment"># lower_case_table_names = 1</span></span><br></pre></td></tr></table></figure>

<p>配置文件参数解读</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br></pre></td><td class="code"><pre><span class="line">[client]</span><br><span class="line"><span class="comment"># 客户端默认连接端口socket</span></span><br><span class="line">port = 3306</span><br><span class="line"></span><br><span class="line"><span class="comment"># 用于本地连接的socket套接字</span></span><br><span class="line">socket = /apps/mysql/lock/mysql.sock</span><br><span class="line">[mysqld]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 服务端基本配置</span></span><br><span class="line"><span class="comment"># mysql服务端监听端口</span></span><br><span class="line">port = 3306</span><br><span class="line"></span><br><span class="line"><span class="comment"># 为mysql客户端程序和服务器之间的本地通讯指定一个套接字文件</span></span><br><span class="line">socket = /apps/mysql/lock/mysql.sock</span><br><span class="line"></span><br><span class="line"><span class="comment"># mysql安装目录</span></span><br><span class="line">basedir = /apps/mysql</span><br><span class="line"></span><br><span class="line"><span class="comment"># mysql数据库数据文件存放目录</span></span><br><span class="line">datadir = /apps/mysql/data</span><br><span class="line"></span><br><span class="line"><span class="comment"># pid所在的目录</span></span><br><span class="line">pid-file = /apps/mysql/run/mysql.pid</span><br><span class="line"></span><br><span class="line"><span class="comment"># 记录mysql错误日志文件</span></span><br><span class="line">log-error = /apps/mysql/logs/mysql-error.log</span><br><span class="line"></span><br><span class="line"><span class="comment"># mysql启动用户</span></span><br><span class="line">user = mysql</span><br><span class="line"></span><br><span class="line"><span class="comment"># 临时目录 比如load data infile会用到,一般都是使用/tmp</span></span><br><span class="line">tmpdir  = /tmp</span><br><span class="line"></span><br><span class="line"><span class="comment"># 表示跳过主机名解析</span></span><br><span class="line"><span class="comment"># 禁止MySQL对外部连接进行DNS解析，使用这一选项可以消除MySQL进行DNS解析的时间。</span></span><br><span class="line"><span class="comment"># 缺点：所有远程主机连接授权都要使用IP地址方式，因为只认得ip地址了。</span></span><br><span class="line">skip_name_resolve = 1</span><br><span class="line"></span><br><span class="line"><span class="comment"># mysql选项以避免外部锁定。该选项默认开启。不使用系统锁定，要使用myisamchk,必须关闭服务器 </span></span><br><span class="line"><span class="comment"># 参考http://www.kuqin.com/database/20120815/328905.html</span></span><br><span class="line">skip-external-locking</span><br><span class="line"></span><br><span class="line"><span class="comment"># 这个参数用来缓存MyISAM存储引擎的索引参数，增加它可得到更好处理的索引(对所有读和多重写)。默认为InnoDB存储引擎，该参数可以设置小点，64M即可。</span></span><br><span class="line"><span class="comment"># 系统将开始换页并且真的变慢了。对于内存在4GB左右的服务器该参数可设置为384M或512M。通过检查状态值Key_read_requests和Key_reads，</span></span><br><span class="line"><span class="comment"># 可以知道key_buffer_size设置是否合理。比例key_reads/key_read_requests应该尽可能的低，  </span></span><br><span class="line"><span class="comment"># 至少是1:100，1:1000更好(上述状态值可以使用SHOW STATUS LIKE &#x27;key_read%&#x27;获得)。注意：该参数值设置的过大反而会是服务器整体效率降低</span></span><br><span class="line">key_buffer_size = 384M</span><br><span class="line"></span><br><span class="line"><span class="comment"># 允许最大接收数据包的大小，防止服务器发送过大的数据包。增加该变量的值十分安全，这是因为仅当需要时才会分配额外内存。例如仅当你发出长查询或mysqld必须返回大的结果行时mysqld才会分配更多内存。可以设置为16MB或者更大，但设置的太大也可能有危险。</span></span><br><span class="line"><span class="comment"># 该变量之所以取较小默认值是一种预防措施，以捕获客户端和服务器之间的错误信息包，并确保不会因偶然使用大的信息包而导致内存溢出。  </span></span><br><span class="line">max_allowed_packet = 16M</span><br><span class="line"></span><br><span class="line"><span class="comment"># MySQL每打开一个表，都会读入一些数据到table_open_cache缓存中，当MySQL在这个缓存中找不到相应信息时，才会去磁盘上读取。默认值64，假定系统有200个并发连接，则需将此参数设置为200*N(N为每个连接所需的文件描述符数目)；当把table_open_cache设置为很大时，如果系统处理不了那么多文件描述符，那么就会出现客户端失效，连接不上。</span></span><br><span class="line"><span class="comment"># 缓存linux文件描述符信息，加快数据文件打开速度</span></span><br><span class="line"><span class="comment"># 它影响myisam表的打开关闭，但是不影响innodb表的打开关闭。</span></span><br><span class="line"><span class="comment"># 默认值2000，建议值：根据状态变量Opened_tables去设定</span></span><br><span class="line">table_open_cache = 512</span><br><span class="line"></span><br><span class="line"><span class="comment"># 缓存表定义的相关信息，加快读取表信息速度</span></span><br><span class="line"><span class="comment"># 默认值1400，最大值2000，建议值：基本不改。</span></span><br><span class="line">table_definition_cache = 1400</span><br><span class="line"><span class="comment"># 该参数是myssql 5.6后引入的，目的是提高并发。</span></span><br><span class="line"><span class="comment"># 默认值1，建议值：cpu核数，并且&lt;=16</span></span><br><span class="line">table_open_cache_instances = 2</span><br><span class="line"></span><br><span class="line"><span class="comment"># MySQL能有的连接数量。当主要MySQL线程在一个很短时间内得到非常多的连接请求，这就起作用，  </span></span><br><span class="line"><span class="comment"># 然后主线程花些时间(尽管很短)检查连接并且启动一个新线程。back_log值指出在MySQL暂时停止回答新请求之前的短时间内多少个请求可以被存在堆栈中。</span></span><br><span class="line"><span class="comment"># 如果期望在一个短时间内有很多连接，你需要增加它。也就是说，如果MySQL的连接数据达到max_connections时，新来的请求将会被存在堆栈中，  </span></span><br><span class="line"><span class="comment"># 以等待某一连接释放资源，该堆栈的数量即back_log，如果等待连接的数量超过back_log，将不被授予连接资源。  </span></span><br><span class="line"><span class="comment"># 另外，这值（back_log）限于您的操作系统对到来的TCP/IP连接的侦听队列的大小。  </span></span><br><span class="line"><span class="comment"># 你的操作系统在这个队列大小上有它自己的限制（可以检查你的OS文档找出这个变量的最大值），试图设定back_log高于你的操作系统的限制将是无效的。</span></span><br><span class="line"><span class="comment"># 在MySQL暂时停止响应新请求之前的短时间内多少个请求可以被存在堆栈中 </span></span><br><span class="line"><span class="comment"># 官方建议back_log = 50 + (max_connections / 5),封顶数为900</span></span><br><span class="line">back_log = 600</span><br><span class="line"></span><br><span class="line"><span class="comment"># MySQL执行排序使用的缓冲大小。如果想要增加ORDER BY的速度，首先看是否可以让MySQL使用索引而不是额外的排序阶段。  </span></span><br><span class="line"><span class="comment"># 如果不能，可以尝试增加sort_buffer_size变量的大小，默认为256k。另外，一般出现Using filesort的时候，要通过增加索引来解决。</span></span><br><span class="line">sort_buffer_size = 8M</span><br><span class="line"></span><br><span class="line"><span class="comment"># 该参数用于表的顺序扫描，表示每个线程分配的缓冲区大小。比如在进行全表扫描时，MySQL会按照数据的存储顺序依次读取数据块，每次读取的数据块首先会暂存在read_buffer_size中，当buffer空间被写满或者全部数据读取结束后，再将buffer中的数据返回给上层调用者，以提高效率。默认为128K，这个参数不要设置过大，一般在128～256之间。如果对表的顺序扫描请求非常频繁，并且你认为频繁扫描进行得太慢，可以通过增加该变量值以及内存缓冲区大小提高其性能</span></span><br><span class="line"><span class="comment"># 为每个扫描MyISAM的线程分配参数设置的内存大小缓冲区。 </span></span><br><span class="line"><span class="comment"># 默认值128kb，建议值：16G内存建议1M，4G：128kb或者256kb吧</span></span><br><span class="line"><span class="comment"># 注意，该缓冲区是每个连接独占的，所以总缓冲区大小为 128kb*连接数；极端情况128kb*maxconnectiosns，会超级大，所以要考虑日常平均连接数。</span></span><br><span class="line"><span class="comment"># 一般不需要太关心该数值，稍微增大就可以了</span></span><br><span class="line">read_buffer_size = 2M  </span><br><span class="line"></span><br><span class="line"><span class="comment"># 该参数用于表的随机读取，表示每个线程分配的缓冲区大小。比如按照一个非索引字段做order by排序操作时，就会利用这个缓冲区来暂存读取的数据。默认为256KB，这个参数不要设置过大，一般在128～512KB。</span></span><br><span class="line"><span class="comment"># mysql会首先扫描一遍该缓冲，以避免磁盘搜索，提高查询速度，如果需要排序大量数据，可适当调高该值。但MySQL会为每个客户连接发放该缓冲空间，所以应尽量适当设置该值，以避免内存开销过大。</span></span><br><span class="line"><span class="comment"># 支持任何存储引擎</span></span><br><span class="line"><span class="comment"># MySQL的随机读缓冲区大小，适当增大，可以提高性能。</span></span><br><span class="line"><span class="comment"># 默认值256kb；建议值：得参考连接数，16G内存，有人推荐8M</span></span><br><span class="line"><span class="comment"># 注意，该缓冲区是每个连接独占的，所以总缓冲区大小为128kb*连接数；极端情况128kb*maxconnectiosns，会超级大，所以要考虑日常平均连接数。</span></span><br><span class="line">read_rnd_buffer_size = 8M</span><br><span class="line"></span><br><span class="line"><span class="comment"># MyISAM设置恢复表之时使用的缓冲区的尺寸，当在REPAIR TABLE或用CREATE INDEX创建索引或ALTER TABLE过程中排序MyISAM索引分配的缓冲区设置太小时可能会遇到” myisam_sort_buffer_size is too small”</span></span><br><span class="line">myisam_sort_buffer_size = 64M</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果临时文件会变得超过索引，不要使用快速排序索引方法来创建一个索引。注释：这个参数以字节的形式给出</span></span><br><span class="line">myisam_max_sort_file_size = 10G</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果该值大于1，在Repair by sorting过程中并行创建MyISAM表索引(每个索引在自己的线程内)</span></span><br><span class="line">myisam_repair_threads = 1 </span><br><span class="line"></span><br><span class="line"><span class="comment"># 线程池，线程缓存。用来缓存空闲的线程，以至于不被销毁，如果线程缓存在的空闲线程，需要重新建立新连接，则会优先调用线程池中的缓存，很快就能响应连接请求。每建立一个连接，都需要一个线程与之匹配。</span></span><br><span class="line"><span class="comment"># 这个值（默认8）表示可以重新利用保存在缓存中线程的数量，当断开连接时如果缓存中还有空间，那么客户端的线程将被放到缓存中，  </span></span><br><span class="line"><span class="comment"># 如果线程重新被请求，那么请求将从缓存中读取,如果缓存中是空的或者是新的请求，那么这个线程将被重新创建,如果有很多新的线程，  </span></span><br><span class="line"><span class="comment"># 增加这个值可以改善系统性能.通过比较Connections和Threads_created状态的变量，可以看到这个变量的作用。(–&gt;表示要调整的值)  </span></span><br><span class="line"><span class="comment"># 根据物理内存设置规则如下：  </span></span><br><span class="line"><span class="comment"># 1G  —&gt; 8  </span></span><br><span class="line"><span class="comment"># 2G  —&gt; 16  </span></span><br><span class="line"><span class="comment"># 3G  —&gt; 32  </span></span><br><span class="line"><span class="comment"># 大于3G  —&gt; 64</span></span><br><span class="line"><span class="comment"># 当客户端断开之后，服务器处理此客户的线程将会缓存起来以响应下一个客户而不是销毁。可重用，减小了系统开销。</span></span><br><span class="line"><span class="comment"># 默认值为9，建议值：两种取值方式，方式一，根据物理内存，1G  —&gt; 8；2G  —&gt; 16； 3G  —&gt; 32； &gt;3G  —&gt; 64；</span></span><br><span class="line"><span class="comment"># 方式二，根据show status like  &#x27;threads%&#x27;，查看Threads_connected值。</span></span><br><span class="line">thread_cache_size = 64</span><br><span class="line"></span><br><span class="line"><span class="comment"># 默认值256k,建议值：16/32G内存，512kb，其他一般不改变，如果报错：Thread stack overrun，就增大看看,</span></span><br><span class="line"><span class="comment"># 注意，每个线程分配内存空间，所以总内存空间。。。你懂得。</span></span><br><span class="line">thread_stack = 512k</span><br><span class="line"></span><br><span class="line"><span class="comment"># 缓存select语句和结果集大小的参数，查询缓存会存储一个select查询的文本与被传送到客户端的相应结果。如果之后接收到一个相同的查询，服务器会从查询缓存中检索结果，而不是再次分析和执行这个同样的查询。如果你的环境中写操作很少，读操作频繁，那么打开query_cache_type=1，会对性能有明显提升。如果写操作频繁，则应该关闭它（query_cache_type=0）。</span></span><br><span class="line"><span class="comment"># 今后对于同样的SELECT语句（区分大小写），将直接从缓冲区中读取结果。根据MySQL用户手册，使用查询缓冲最多可以达到238%的效率。  </span></span><br><span class="line"><span class="comment"># 通过检查状态值&#x27;Qcache_%&#x27;，可以知道query_cache_size设置是否合理：如果Qcache_lowmem_prunes的值非常大，则表明经常出现缓冲不够的情况，  </span></span><br><span class="line"><span class="comment"># 如果Qcache_hits的值也非常大，则表明查询缓冲使用非常频繁，此时需要增加缓冲大小；如果Qcache_hits的值不大，则表明你的查询重复率很低，  </span></span><br><span class="line"><span class="comment"># 这种情况下使用查询缓冲反而会影响效率，那么可以考虑不用查询缓冲。此外，在SELECT语句中加入SQL_NO_CACHE可以明确表示不使用查询缓冲</span></span><br><span class="line"><span class="comment"># 默认值1M，优点是查询缓冲可以极大的提高服务器速度, 如果你有大量的相同的查询并且很少修改表。</span></span><br><span class="line"><span class="comment"># 缺点：在你表经常变化的情况下或者如果你的查询原文每次都不同,查询缓冲也许引起性能下降而不是性能提升。</span></span><br><span class="line">query_cache_size = 32M  </span><br><span class="line"></span><br><span class="line"><span class="comment"># 指定单个查询能够使用的缓冲区大小，默认1M。</span></span><br><span class="line"><span class="comment"># 只有小于此设定值的结果才会被缓冲，保护查询缓冲,防止一个极大的结果集将其他所有的查询结果都覆盖。</span></span><br><span class="line">query_cache_limit = 2M</span><br><span class="line"></span><br><span class="line"><span class="comment"># 每个被缓存的结果集要占用的最小内存,默认值4kb，一般不怎么调整。</span></span><br><span class="line"><span class="comment"># 如果Qcache_free_blocks值过大，可能是query_cache_min_res_unit值过大，应该调小些</span></span><br><span class="line"><span class="comment"># query_cache_min_res_unit的估计值：(query_cache_size - Qcache_free_memory) / Qcache_queries_in_cache</span></span><br><span class="line">query_cache_min_res_unit = 4kb</span><br><span class="line"></span><br><span class="line"><span class="comment"># 临时HEAP数据表的最大长度(默认设置是32M)，</span></span><br><span class="line"><span class="comment"># MySQL的heap（堆积）表缓冲大小。所有联合在一个DML指令内完成，并且大多数联合甚至可以不用临时表即可以完成。  </span></span><br><span class="line"><span class="comment"># 大多数临时表是基于内存的(HEAP)表。具有大的记录长度的临时表 (所有列的长度的和)或包含BLOB列的表存储在硬盘上。  </span></span><br><span class="line"><span class="comment"># 如果某个内部heap（堆积）表大小超过tmp_table_size，MySQL可以根据需要自动将内存中的heap表改为基于硬盘的MyISAM表。还可以通过设置tmp_table_size选项来增加临时表的大小。也就是说，如果调高该值，MySQL同时将增加heap表的大小，可达到提高联接查询速度的效果</span></span><br><span class="line"><span class="comment"># 内存临时表的最大值,默认16M</span></span><br><span class="line">tmp_table_size = 64M  </span><br><span class="line"></span><br><span class="line"><span class="comment"># 联合查询操作所能使用的缓冲区大小，和sort_buffer_size一样，该参数对应的分配内存也是每连接独享</span></span><br><span class="line"><span class="comment"># 此缓冲被使用来优化全联合(full JOINs 不带索引的联合)</span></span><br><span class="line"><span class="comment"># 类似的联合在极大多数情况下有非常糟糕的性能表现,但是将此值设大能够减轻性能影响.</span></span><br><span class="line"><span class="comment"># 通过 “Select_full_join” 状态变量查看全联合的数量</span></span><br><span class="line"><span class="comment"># 注意，该缓冲区是每个连接独占的，所以总缓冲区大小为 1M*连接数；极端情况1M*maxconnectiosns，会超级大。所以要考虑日常平均连接数。</span></span><br><span class="line"><span class="comment"># 默认值256kb;建议值：16G内存，设置8M.</span></span><br><span class="line">join_buffer_size = 64M</span><br><span class="line"></span><br><span class="line"><span class="comment"># 该值一般建议设定cpu的个数*2</span></span><br><span class="line">thread_concurrency = 4</span><br><span class="line"></span><br><span class="line"><span class="comment"># 分词词汇最小长度，默认值为4  </span></span><br><span class="line">ft_min_word_len = 4</span><br><span class="line"></span><br><span class="line"><span class="comment"># 是否显示默认时间戳，true是显示</span></span><br><span class="line"><span class="comment"># 默认值为off,timestamp列会自动更新为当前时间，设置为on|1，timestamp列的值就要显式更新</span></span><br><span class="line">explicit_defaults_for_timestamp = true</span><br><span class="line"></span><br><span class="line"><span class="comment"># 开启该选项后就不能远程访问MySQL</span></span><br><span class="line"><span class="comment"># 为安全考虑希望指定的IP访问MySQL，可以在配置文件中增加bind-address=IP，前提是关闭skip-networking</span></span><br><span class="line"><span class="comment"># skip-networking</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 表示监听IPV4地址</span></span><br><span class="line">bind-address=192.168.1.146</span><br><span class="line"></span><br><span class="line"><span class="comment"># 该参数是用来设定mysql的最大连接数，默认为100，一般设置为512-1000即可。太多的连接会导致内存的使用量过高并且会锁住你的MySQL服务器。一般小型网站需要100-200的连接数，而较大可能需要500-800甚至更多。这里的值很大程度上取决于你 MySQL/MariaDB 的使用情况。</span></span><br><span class="line"><span class="comment"># 如果服务器的并发连接请求量比较大，建议调高此值，以增加并行连接数量，当然这建立在机器能支撑的情况下，因为如果连接数越多，介于MySQL会为每个连接提供连接缓冲区，就会开销越多的内存，所以要适当调整该值，不能盲目提高设值。可以过&#x27;conn%&#x27;通配符查看当前状态的连接数量，以定夺该值的大小。</span></span><br><span class="line"><span class="comment"># 最大连接数，可设最大值16384，一般考虑根据同时在线人数设置一个比较综合的数字，鉴于该数值增大并不太消耗系统资源，建议直接设10000</span></span><br><span class="line"><span class="comment"># 如果在访问时经常出现Too Many Connections的错误提示，则需要增大该参数值</span></span><br><span class="line">max_connections = 1000</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果有时网络异常或者应用配置错误，或者其他原因导致客户端短时间内不断的尝试连接，超出该参数值个数的中断错误连接。该主机将被禁止连接，可能会被列入黑名单。然后将无法连接，直到再次刷新主机缓存。如需对该主机进行解禁需执行FLUSH HOST。这个选项默认值太小了，可以考虑设的足够大（如果你的服务器配置够强大的话)。</span></span><br><span class="line"><span class="comment"># 默认值100，最大错误连接数，如果有超出该参数值个数的中断错误连接，则该主机将被禁止连接。如需对该主机进行解禁，执行：FLUSH HOST</span></span><br><span class="line"><span class="comment"># 考虑高并发场景下的容错，建议加大。</span></span><br><span class="line">max_connect_errors = 1000</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设定mysql打开最大文件数，MySQL打开的文件描述符限制，默认最小1024，当open_files_limit没有被配置的时候，比较max_connections*5和ulimit -n的值，哪个大用哪个。</span></span><br><span class="line"><span class="comment"># 注意：仍然可能出现报错信息Can&#x27;t create a new thread；此时观察系统cat /proc/mysql进程号/limits，观察进程ulimit限制情况</span></span><br><span class="line"><span class="comment"># 过小的话，考虑修改系统配置表，/etc/security/limits.conf和/etc/security/limits.d/90-nproc.conf </span></span><br><span class="line">open_files_limit = 65535</span><br><span class="line"></span><br><span class="line"><span class="comment"># 事务隔离级别，默认为可重复读（REPEATABLE-READ）。（此级别下可能参数很多间隙锁，影响性能，但是修改又影响主从复制及灾难恢复，建议还是修改代码逻辑吧）</span></span><br><span class="line"><span class="comment"># 隔离级别可选项目：READ-UNCOMMITTED  READ-COMMITTED  REPEATABLE-READ  SERIALIZABLE</span></span><br><span class="line"><span class="comment"># 如没有指定，MySQL默认采用的是REPEATABLE-READ，ORACLE默认的是READ-COMMITTED</span></span><br><span class="line"><span class="comment"># transaction_isolation = READ-COMMITTED</span></span><br><span class="line">transaction_isolation = REPEATABLE-READ</span><br><span class="line"></span><br><span class="line"><span class="comment"># MySQL的二进制日志可以说是MySQL最重要的日志了，它记录了所有的DDL和DML(除了数据查询语句)语句，以事件形式记录，还包含语句所执行的消耗的时间，MySQL的二进制日志是事务安全型的。</span></span><br><span class="line"><span class="comment"># 一般来说开启二进制日志大概会有1%的性能损耗(参见MySQL官方中文手册 5.1.24版)。二进制有两个最重要的使用场景: </span></span><br><span class="line"><span class="comment"># 其一：MySQL Replication在Master端开启binlog，Mster把它的二进制日志传递给slaves来达到master-slave数据一致的目的。 </span></span><br><span class="line"><span class="comment"># 其二：自然就是数据恢复了，通过使用mysqlbinlog工具来使恢复数据。</span></span><br><span class="line"><span class="comment"># 查看方式:binlog events in &#x27;mysql-bin.000256&#x27;;</span></span><br><span class="line">log-bin=mysql-bin</span><br><span class="line"></span><br><span class="line"><span class="comment"># 指定日志格式为mixed</span></span><br><span class="line">binlog_format=mixed</span><br><span class="line"></span><br><span class="line"><span class="comment"># 一个事务在没有提交的时候产生的日志会记录到Cache中；等到事务提交需要提交的时候，则把日志持久化到磁盘。该值默认大小32K，可以自行设定。</span></span><br><span class="line"><span class="comment"># 在一个事务中binlog为了记录SQL状态所持有的cache大小</span></span><br><span class="line"><span class="comment"># 如果你经常使用大的,多声明的事务,你可以增加此值来获取更大的性能.</span></span><br><span class="line"><span class="comment"># 所有从事务来的状态都将被缓冲在binlog缓冲中然后在提交后一次性写入到binlog中</span></span><br><span class="line"><span class="comment"># 如果事务比此值大, 会使用磁盘上的临时文件来替代.</span></span><br><span class="line"><span class="comment"># 此缓冲在每个连接的事务第一次更新状态时被创建</span></span><br><span class="line">binlog_cache_size = 64M</span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义了用户可以创建的内存表(memory table)的大小。这个值用来计算内存表的最大行数值。这个变量支持动态改变</span></span><br><span class="line"><span class="comment"># 用户创建的内存表的大小，默认16M，往往和tmp_table_size一起设置，限制用户临师表大小。</span></span><br><span class="line"><span class="comment"># 超限的话，MySQL就会自动地把它转化为基于磁盘的MyISAM表，存储在指定的tmpdir目录下，增大IO压力，建议内存大，增大该数值。</span></span><br><span class="line">max_heap_table_size = 8M</span><br><span class="line"></span><br><span class="line"><span class="comment"># 表示这个mysql版本是否支持查询缓存。ps：SHOW STATUS LIKE &#x27;qcache%&#x27;，与缓存相关的状态变量。</span></span><br><span class="line"><span class="comment"># have_query_cache</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 这个系统变量控制着查询缓存工能的开启的关闭，0时表示关闭，1时表示打开，2表示只要select 中明确指定SQL_CACHE才缓存。</span></span><br><span class="line"><span class="comment"># 看业务场景决定是否使用缓存，不使用，下面就不用配置了。</span></span><br><span class="line">query_cache_type = 0 </span><br><span class="line"></span><br><span class="line"><span class="comment"># 表示是本机的序号为1,给服务器分配一个独一无二的ID编号; n的取值范围是1~2的32次方启用二进制日志功能。在复制数据同步的时候会用到，一般来讲就是master的意思</span></span><br><span class="line">server-id = 1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 数据库引擎与字符集相关设置</span></span><br><span class="line"><span class="comment"># mysql 5.1 之后，默认引擎就是InnoDB了</span></span><br><span class="line">default_storage_engine = InnoDB</span><br><span class="line"></span><br><span class="line"><span class="comment"># 内存临时表默认引擎，默认InnoDB</span></span><br><span class="line">default_tmp_storage_engine = InnoDB</span><br><span class="line"></span><br><span class="line"><span class="comment"># mysql 5.7新增特性，磁盘临时表默认引擎，默认InnoDB</span></span><br><span class="line">internal_tmp_disk_storage_engine = InnoDB</span><br><span class="line"></span><br><span class="line"><span class="comment"># 数据库默认字符集,主流字符集支持一些特殊表情符号（特殊表情符占用4个字节）</span></span><br><span class="line">character-set-server = utf8</span><br><span class="line"></span><br><span class="line"><span class="comment"># 数据库字符集对应一些排序等规则，注意要和character-set-server对应</span></span><br><span class="line">collation-server = utf8_general_ci</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置client连接mysql时的字符集,防止乱码</span></span><br><span class="line"><span class="comment"># init_connect=&#x27;SET NAMES utf8&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 是否对sql语句大小写敏感，默认值为0，1表示不敏感</span></span><br><span class="line">lower_case_table_names = 1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 服务器关闭交互式连接前等待活动的秒数。交互式客户端定义为在mysql_real_connect()中使用CLIENT_INTERACTIVE选项的客户端。默认值：28800秒（8小时）</span></span><br><span class="line"><span class="comment"># MySQL默认的wait_timeout  值为8个小时, interactive_timeout参数需要同时配置才能生效</span></span><br><span class="line"><span class="comment"># MySQL连接闲置超过一定时间后(单位：秒，此处为1800秒)将会被强行关闭</span></span><br><span class="line">interactive_timeout = 28800</span><br><span class="line"></span><br><span class="line"><span class="comment"># 服务器关闭非交互连接之前等待活动的秒数。在线程启动时，根据全局wait_timeout值或全局interactive_timeout值初始化会话wait_timeout值，  </span></span><br><span class="line"><span class="comment"># 取决于客户端类型(由mysql_real_connect()的连接选项CLIENT_INTERACTIVE定义)。参数默认值：28800秒（8小时）  </span></span><br><span class="line"><span class="comment"># MySQL服务器所支持的最大连接数是有上限的，因为每个连接的建立都会消耗内存，因此我们希望客户端在连接到MySQL Server处理完相应的操作后，  </span></span><br><span class="line"><span class="comment"># 应该断开连接并释放占用的内存。如果你的MySQL Server有大量的闲置连接，他们不仅会白白消耗内存，而且如果连接一直在累加而不断开，  </span></span><br><span class="line"><span class="comment"># 最终肯定会达到MySQL Server的连接上限数，这会报&#x27;too many connections&#x27;的错误。对于wait_timeout的值设定，应该根据系统的运行情况来判断 </span></span><br><span class="line"><span class="comment"># 在系统运行一段时间后，可以通过show processlist命令查看当前系统的连接状态，如果发现有大量的sleep状态的连接进程，则说明该参数设置的过大，  </span></span><br><span class="line"><span class="comment"># 可以进行适当的调整小些。要同时设置interactive_timeout和wait_timeout才会生效。</span></span><br><span class="line">wait_timeout = 28800</span><br><span class="line"></span><br><span class="line"><span class="comment"># 处理主键冲突</span></span><br><span class="line"><span class="comment"># mysql的服务器变量auto_increment_increment【增长值】和auto_increment_offset【偏移量】可以协调多主服务器复制和AUTO_INCREMENT列。</span></span><br><span class="line"><span class="comment"># 并且每个变量有一个默认的(并且是最小的)值1，有一个最大值65,535。把这些变量设置为非冲突的值，例如在同 一个表插入新行时，</span></span><br><span class="line"><span class="comment"># 多主服务器配置主的服务器就不会发生AUTO_INCREMENT值冲突，这里就可以解决这个问题</span></span><br><span class="line">auto-increment-increment = 2</span><br><span class="line">auto-increment-offset = 2</span><br><span class="line"></span><br><span class="line"><span class="comment"># slave_skip_errors跳过复制错误选项有四个可用值，分别为：off，all，ErorCode，ddl_exist_errors。</span></span><br><span class="line"><span class="comment"># 默认情况下该参数值是off，我们可以列出具体的error code，也可以选择all，mysql5.6及MySQL Cluster NDB 7.3以及后续版本增加了参数ddl_exist_errors，该参数包含一系列error code（1007,1008,1050,1051,1054,1060,1061,1068,1094,1146）</span></span><br><span class="line"><span class="comment"># 一些error code代表的错误如下：</span></span><br><span class="line">    1007：数据库已存在，创建数据库失败</span><br><span class="line">    1008：数据库不存在，删除数据库失败</span><br><span class="line">    1050：数据表已存在，创建数据表失败</span><br><span class="line">    1051：数据表不存在，删除数据表失败</span><br><span class="line">    1054：字段不存在，或程序文件跟数据库有冲突</span><br><span class="line">    1060：字段重复，导致无法插入</span><br><span class="line">    1061：重复键名</span><br><span class="line">    1068：定义了多个主键</span><br><span class="line">    1094：位置线程ID</span><br><span class="line">    1146：数据表缺失，请恢复数据库</span><br><span class="line">    1053：复制过程中主服务器宕机</span><br><span class="line">    1062：主键冲突 Duplicate entry &#x27;%s&#x27; for key %d</span><br><span class="line">slave_skip_errors=all</span><br><span class="line"></span><br><span class="line">sql_mode=&#x27;ONLY_FULL_GROUP_BY,NO_AUTO_VALUE_ON_ZERO,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,</span><br><span class="line">ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,PIPES_AS_CONCAT,ANSI_QUOTES&#x27;</span><br><span class="line">MySQL的sql_mode模式说明及设置</span><br><span class="line">MySQL的sql_mode合理设置</span><br><span class="line">sql_mode是个很容易被忽视的变量,默认值是空值,在这种设置下是可以允许一些非法操作的,比如允许一些非法数据的插入。在生产环境必须将这个值设置为严格模式,所以开发、测试环境的数据库也必须要设置,这样在开发测试阶段就可以发现问题.</span><br><span class="line">sql model 常用来解决下面几类问题</span><br><span class="line">(1) 通过设置sql mode, 可以完成不同严格程度的数据校验，有效地保障数据准备性。</span><br><span class="line">(2) 通过设置sql model 为宽松模式，来保证大多数sql符合标准的sql语法，这样应用在不同数据库之间进行迁移时，则不需要对业务sql 进行较大的修改。</span><br><span class="line">(3) 在不同数据库之间进行数据迁移之前，通过设置SQL Mode 可以使MySQL 上的数据更方便地迁移到目标数据库中。</span><br><span class="line"></span><br><span class="line"><span class="section">sql_mode常用值如下: </span></span><br><span class="line"><span class="section">ONLY_FULL_GROUP_BY:</span></span><br><span class="line">对于GROUP BY聚合操作,如果在SELECT中的列,没有在GROUP BY中出现,那么这个SQL是不合法的,因为列不在GROUP BY从句中</span><br><span class="line"></span><br><span class="line"><span class="section">NO_AUTO_VALUE_ON_ZERO:</span></span><br><span class="line">该值影响自增长列的插入。默认设置下,插入0或NULL代表生成下一个自增长值。如果用户 希望插入的值为0,而该列又是自增长的,那么这个选项就有用了。</span><br><span class="line"></span><br><span class="line"><span class="section">STRICT_TRANS_TABLES:</span></span><br><span class="line">在该模式下,如果一个值不能插入到一个事务表中,则中断当前的操作,对非事务表不做限制</span><br><span class="line"></span><br><span class="line"><span class="section">NO_ZERO_IN_DATE:</span></span><br><span class="line">在严格模式下,不允许日期和月份为零</span><br><span class="line"></span><br><span class="line"><span class="section">NO_ZERO_DATE:</span></span><br><span class="line">设置该值,mysql数据库不允许插入零日期,插入零日期会抛出错误而不是警告。</span><br><span class="line"></span><br><span class="line"><span class="section">ERROR_FOR_DIVISION_BY_ZERO:</span></span><br><span class="line">在INSERT或UPDATE过程中,如果数据被零除,则产生错误而非警告。如 果未给出该模式,那么数据被零除时MySQL返回NULL</span><br><span class="line"></span><br><span class="line"><span class="section">NO_AUTO_CREATE_USER:</span></span><br><span class="line">禁止GRANT创建密码为空的用户</span><br><span class="line"></span><br><span class="line"><span class="section">NO_ENGINE_SUBSTITUTION:</span></span><br><span class="line">如果需要的存储引擎被禁用或未编译,那么抛出错误。不设置此值时,用默认的存储引擎替代,并抛出一个异常</span><br><span class="line"></span><br><span class="line"><span class="section">PIPES_AS_CONCAT:</span></span><br><span class="line">将<span class="string">&quot;||&quot;</span>视为字符串的连接操作符而非或运算符,这和Oracle数据库是一样的,也和字符串的拼接函数Concat相类似</span><br><span class="line"></span><br><span class="line"><span class="section">ANSI_QUOTES:</span></span><br><span class="line">启用ANSI_QUOTES后,不能用双引号来引用字符串,因为它被解释为识别符</span><br><span class="line"><span class="section">ORACLE的sql_mode设置等同:PIPES_AS_CONCAT, ANSI_QUOTES, IGNORE_SPACE, NO_KEY_OPTIONS, NO_TABLE_OPTIONS, NO_FIELD_OPTIONS, NO_AUTO_CREATE_USER.</span></span><br><span class="line"><span class="section">如果使用mysql,为了继续保留大家使用oracle的习惯,可以对mysql的sql_mode设置如下:</span></span><br><span class="line"></span><br><span class="line">注意：MySQL5.6和MySQL5.7默认的sql_mode模式参数是不一样的,5.6的mode是NO_ENGINE_SUBSTITUTION，其实表示的是一个空值，相当于没有什么模式设置，可以理解为宽松模式。5.7的mode是STRICT_TRANS_TABLES，也就是严格模式。</span><br><span class="line">如果设置的是宽松模式，那么我们在插入数据的时候，即便是给了一个错误的数据，也可能会被接受，并且不报错，例如：我在创建一个表时，该表中有一个字段为name，给name设置的字段类型时char(10)，如果我在插入数据的时候，其中name这个字段对应的有一条数据的长度超过了10，例如&#x27;1234567890abc&#x27;，超过了设定的字段长度10，那么不会报错，并且取前十个字符存上，也就是说你这个数据被存为了&#x27;1234567890&#x27;,而&#x27;abc&#x27;就没有了，但是我们知道，我们给的这条数据是错误的，因为超过了字段长度，但是并没有报错，并且mysql自行处理并接受了，这就是宽松模式的效果，其实在开发、测试、生产等环境中，我们应该采用的是严格模式，出现这种错误，应该报错才对，所以MySQL5.7版本就将sql_mode默认值改为了严格模式，并且我们即便是用的MySQL5.6，也应该自行将其改为严格模式，而你记着，MySQL等等的这些数据库，都是想把关于数据的所有操作都自己包揽下来，包括数据的校验，其实好多时候，我们应该在自己开发的项目程序级别将这些校验给做了，虽然写项目的时候麻烦了一些步骤，但是这样做之后，我们在进行数据库迁移或者在项目的迁移时，就会方便很多，这个看你们自行来衡量。mysql除了数据校验之外，你慢慢的学习过程中会发现，它能够做的事情还有很多很多，将你程序中做的好多事情都包揽了。</span><br><span class="line"></span><br><span class="line">改为严格模式后可能会存在的问题：</span><br><span class="line">若设置模式中包含了NO_ZERO_DATE，那么MySQL数据库不允许插入零日期，插入零日期会抛出错误而不是警告。例如表中含字段TIMESTAMP列（如果未声明为NULL或显示DEFAULT子句）将自动分配DEFAULT &#x27;0000-00-00 00:00:00&#x27;（零时间戳），也或者是本测试的表day列默认允许插入零日期 &#x27;0000-00-00&#x27; COMMENT &#x27;日期&#x27;；这些显然是不满足sql_mode中的NO_ZERO_DATE而报错。</span><br><span class="line"></span><br><span class="line">模式设置和修改(以解决上述问题为例)：</span><br><span class="line">方式一：先执行select @@sql_mode,复制查询出来的值并将其中的NO_ZERO_IN_DATE,NO_ZERO_DATE删除，然后执行set sql_mode = &#x27;修改后的值&#x27;或者set session sql_mode=&#x27;修改后的值&#x27;;，例如：set session sql_mode=&#x27;STRICT_TRANS_TABLES&#x27;;改为严格模式</span><br><span class="line">此方法只在当前会话中生效，关闭当前会话就不生效了。</span><br><span class="line">方式二：先执行select @@global.sql_mode,复制查询出来的值并将其中的NO_ZERO_IN_DATE,NO_ZERO_DATE删除，然后执行set global sql_mode = &#x27;修改后的值&#x27;。</span><br><span class="line">此方法在当前服务中生效，重新MySQL服务后失效</span><br><span class="line">方法三：在mysql的安装目录下，或my.cnf文件(windows系统是my.ini文件)，新增 sql_mode = ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER,NO_ENGINE_SUBSTITUTION，</span><br><span class="line">添加my.cnf如下：</span><br><span class="line">[mysqld]</span><br><span class="line">sql_mode=ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,ERROR_FOR_DIVISION_BY_ZERO,NO_AUTO_CREATE_USER</span><br><span class="line">然后重启mysql。</span><br><span class="line">此方法永久生效.当然生产环境上是禁止重启MySQL服务的，所以采用方式二加方式三来解决线上的问题，那么即便是有一天真的重启了MySQL服务，也会永久生效了。</span><br><span class="line"></span><br><span class="line">[mysqldump]</span><br><span class="line"><span class="comment"># quick选项强制 mysqldump 从服务器查询取得记录直接输出而不是取得所有记录后将它们缓存到内存中</span></span><br><span class="line">quick</span><br><span class="line">quick</span><br><span class="line"><span class="comment"># 该参数限制服务器端，接受的数据包大小，如果有BLOB子段，建议增大此值，避免写入或者更新出错。有BLOB子段，建议改为1024M</span></span><br><span class="line"><span class="comment"># 服务器发送和接受的最大包长度</span></span><br><span class="line">max_allowed_packet = 16M</span><br><span class="line"></span><br><span class="line">[mysql]</span><br><span class="line">auto-rehash是自动补全的意思，就像我们在linux命令行里输入命令的时候，使用tab键的功能是一样的。</span><br><span class="line">no-auto-rehash</span><br><span class="line"></span><br><span class="line">[myisamchk]</span><br><span class="line"><span class="comment"># *** MyISAM 相关选项</span></span><br><span class="line"><span class="comment"># 指定索引缓冲区的大小, 为MYISAM数据表开启供线程共享的索引缓存,对INNODB引擎无效。相当影响MyISAM的性能。</span></span><br><span class="line"><span class="comment"># 不要将其设置大于你可用内存的30%,因为一部分内存同样被OS用来缓冲行数据</span></span><br><span class="line"><span class="comment"># 甚至在你并不使用MyISAM 表的情况下, 你也需要仍旧设置起 8-64M 内存由于它同样会被内部临时磁盘表使用.</span></span><br><span class="line"><span class="comment"># 默认值 8M，建议值：对于内存在4GB左右的服务器该参数可设置为256M或384M。注意：该参数值设置的过大反而会是服务器整体效率降低！</span></span><br><span class="line">key_buffer_size = 384M</span><br><span class="line"></span><br><span class="line"><span class="comment"># order by或group by时用到 </span></span><br><span class="line"><span class="comment"># 支持所有引擎，innodb和myisam有自己的innodb_sort_buffer_size和myisam_sort_buffer_size设置</span></span><br><span class="line"><span class="comment"># 默认值256kb；建议值：得参考连接数，16G内存，有人推荐8M.</span></span><br><span class="line"><span class="comment"># 注意，该缓冲区是每个连接独占的，所以总缓冲区大小为 1M*连接数；极端情况1M*maxconnectiosns，会超级大。所以要考虑日常平均连接数。</span></span><br><span class="line">sort_buffer_size = 256M</span><br><span class="line"></span><br><span class="line"><span class="comment"># 为每个扫描MyISAM的线程分配参数设置的内存大小缓冲区。 </span></span><br><span class="line"><span class="comment"># 默认值128kb，建议值：16G内存建议1M，4G：128kb或者256kb吧</span></span><br><span class="line"><span class="comment"># 注意，该缓冲区是每个连接独占的，所以总缓冲区大小为 128kb*连接数；极端情况128kb*maxconnectiosns，会超级大，所以要考虑日常平均连接数。</span></span><br><span class="line"><span class="comment"># 一般不需要太关心该数值，稍微增大就可以了</span></span><br><span class="line">read_buffer = 128M</span><br><span class="line">write_buffer = 128M</span><br><span class="line"></span><br><span class="line"><span class="comment"># mysql命令行工具不使用自动补全功能，建议还是改为</span></span><br><span class="line"><span class="comment"># no-auto-rehash</span></span><br><span class="line">auto-rehash</span><br><span class="line">[mysqlhotcopy]</span><br><span class="line"><span class="comment"># 服务器关闭交互式连接前等待活动的秒数。交互式客户端定义为在mysql_real_connect()中使用CLIENT_INTERACTIVE选项的客户端。默认值：28800秒（8小时）</span></span><br><span class="line">interactive-timeout</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 日志文件相关设置，一般只开启三种日志，错误日志，慢查询日志，二进制日志。普通查询日志不开启。</span></span><br><span class="line"><span class="comment"># 普通查询日志，默认值off，不开启</span></span><br><span class="line">general_log = 0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 普通查询日志存放地址</span></span><br><span class="line">general_log_file = /usr/local/mysql-5.7.21/log/mysql-general.log</span><br><span class="line"></span><br><span class="line"><span class="comment"># 全局动态变量，默认3，范围：1～3</span></span><br><span class="line"><span class="comment"># 表示错误日志记录的信息，1：只记录error信息；2：记录error和warnings信息；3：记录error、warnings和普通的notes信息。</span></span><br><span class="line">log_error_verbosity = 2</span><br><span class="line"></span><br><span class="line"><span class="comment"># 错误日志文件地址</span></span><br><span class="line">log_error = /usr/local/mysql-5.7.21/log/mysql-error.log</span><br><span class="line"></span><br><span class="line"><span class="comment"># 开启慢查询</span></span><br><span class="line">slow_query_log = 1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 开启慢查询时间，此处为1秒，达到此值才记录数据</span></span><br><span class="line">long_query_time = 3</span><br><span class="line"></span><br><span class="line"><span class="comment"># 慢查询日志文件地址</span></span><br><span class="line">slow_query_log_file = /usr/local/mysql/log/mysql-slow.log</span><br><span class="line"></span><br><span class="line"><span class="comment"># 检索行数达到此数值，才记录慢查询日志中</span></span><br><span class="line">min_examined_row_limit = 100</span><br><span class="line"></span><br><span class="line"><span class="comment"># mysql 5.6.5新增，用来表示每分钟允许记录到slow log的且未使用索引的SQL语句次数，默认值为0，不限制。</span></span><br><span class="line">log_throttle_queries_not_using_indexes = 0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 开启记录没有使用索引查询语句</span></span><br><span class="line">log-queries-not-using-indexes = 1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置此参数表示启用binlog功能，并指定路径名称</span></span><br><span class="line">log_bin=/usr/local/mysql/log/mysql-bin.log</span><br><span class="line"></span><br><span class="line">设置此参数是指定二进制索引文件的路径与名称</span><br><span class="line">log_bin_index</span><br><span class="line"></span><br><span class="line">此参数表示只记录指定数据库的二进制日志</span><br><span class="line">binlog_do_db</span><br><span class="line"></span><br><span class="line">此参数表示不记录指定的数据库的二进制日志</span><br><span class="line">binlog_ignore_db</span><br><span class="line"></span><br><span class="line">此参数表示binlog使用的内存最大的尺寸</span><br><span class="line">max_binlog_cache_size</span><br><span class="line"></span><br><span class="line">此参数表示binlog使用的内存大小，可以通过状态变量binlog_cache_use和binlog_cache_disk_use来帮助测试。</span><br><span class="line">binlog_cache_size</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用二进制日志缓存的事务数量</span></span><br><span class="line">binlog_cache_use</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用二进制日志缓存但超过binlog_cache_size值并使用临时文件来保存事务中的语句的事务数量</span></span><br><span class="line">binlog_cache_disk_use</span><br><span class="line"></span><br><span class="line"><span class="comment"># Binlog最大值，最大和默认值是1GB，该设置并不能严格控制Binlog的大小，尤其是Binlog比较靠近最大值而又遇到一个比较大事务时，为了保证事务的完整性，不可能做切换日志的动作，只能将该事务的所有SQL都记录进当前日志，直到事务结束</span></span><br><span class="line"><span class="comment"># 如果二进制日志写入的内容超出给定值，日志就会发生滚动。你不能将该变量设置为大于1GB或小于4096字节。 默认值是1GB。</span></span><br><span class="line">max_binlog_size</span><br><span class="line"></span><br><span class="line">sync_binlog”：这个参数是对于MySQL系统来说是至关重要的，他不仅影响到Binlog对MySQL所带来的性能损耗，而且还影响到MySQL中数据的完整性。对于“sync_binlog”参数的各种设置的说明如下：</span><br><span class="line">sync_binlog=0，当事务提交之后，MySQL不做fsync之类的磁盘同步指令刷新binlog_cache中的信息到磁盘，而让Filesystem自行决定什么时候来做同步，或者cache满了之后才同步到磁盘。</span><br><span class="line">sync_binlog=n，当每进行n次事务提交之后，MySQL将进行一次fsync之类的磁盘同步指令来将binlog_cache中的数据强制写入磁盘。</span><br><span class="line">在MySQL中系统默认的设置是sync_binlog=0，也就是不做任何强制性的磁盘刷新指令，这时候的性能是最好的，但是风险也是最大的。因为一旦系统Crash，在binlog_cache中的所有binlog信息都会被丢失。而当设置为“1”的时候，是最安全但是性能损耗最大的设置。因为当设置为1的时候，即使系统Crash，也最多丢失binlog_cache中未完成的一个事务，对实际数据没有任何实质性影响。</span><br><span class="line">从以往经验和相关测试来看，对于高并发事务的系统来说，“sync_binlog”设置为0和设置为1的系统写入性能差距可能高达5倍甚至更多。</span><br><span class="line">sync_binlog=1</span><br><span class="line">show variables like <span class="string">&#x27;sync_binlog&#x27;</span>;</span><br><span class="line"><span class="built_in">set</span> global sync_binlog=0;</span><br><span class="line"></span><br><span class="line"><span class="comment"># relay log很多方面都跟binary log差不多。</span></span><br><span class="line"><span class="comment"># 区别是：从服务器I/O线程将主服务器的二进制日志读取过来记录到从服务器本地文件，然后SQL线程会读取relay-log日志的内容并应用到从服务器，从而使从服务器和主服务器的数据保持一致</span></span><br><span class="line"><span class="comment"># 查看方式：show replylog events in &#x27;mysql-reply-bin.000256&#x27;;</span></span><br><span class="line">relay_log = /data/mysql/mysql-relay-bin</span><br><span class="line"></span><br><span class="line">relay <span class="built_in">log</span>的相关参数：</span><br><span class="line">通过语句：show variables like <span class="string">&#x27;%relay%&#x27;</span>，查看先骨干的relay的所有相关参数</span><br><span class="line">mysql&gt; show variables like <span class="string">&#x27;%relay%&#x27;</span>;</span><br><span class="line">+-----------------------+----------------+</span><br><span class="line">| Variable_name | Value |</span><br><span class="line">+-----------------------+----------------+</span><br><span class="line">| max_relay_log_size | 0 |</span><br><span class="line">| relay_log | |</span><br><span class="line">| relay_log_index | |</span><br><span class="line">| relay_log_info_file | relay-log.info |</span><br><span class="line">| relay_log_purge | ON |</span><br><span class="line">| relay_log_recovery | OFF |</span><br><span class="line">| relay_log_space_limit | 0 |</span><br><span class="line">| sync_relay_log | 0 |</span><br><span class="line">| sync_relay_log_info | 0 |</span><br><span class="line">+-----------------------+----------------+</span><br><span class="line">9 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.08 sec)</span><br><span class="line">2.1 max_relay_log_size：标记relay <span class="built_in">log</span> 允许的最大值，如果该值为0，则默认值为max_binlog_size(1G)；如果不为0，则max_relay_log_size则为最大的relay_log文件大小；</span><br><span class="line">2.2 relay_log：定义relay_log的位置和名称，如果值为空，则默认位置在数据文件的目录，文件名为host_name-relay-bin.nnnnnn（By default, relay <span class="built_in">log</span> file names have the form host_name-relay-bin.nnnnnn <span class="keyword">in</span> the data directory）；</span><br><span class="line">2.3relay_log_index：同relay_log，定义relay_log的位置和名称；</span><br><span class="line">2.4relay_log_info_file：设置relay-log.info的位置和名称（relay-log.info记录MASTER的binary_log的恢复位置和relay_log的位置）</span><br><span class="line">2.5relay_log_purge：是否自动清空不再需要中继日志时。默认值为1(启用)。</span><br><span class="line">2.6relay_log_recovery：当slave从库宕机后，假如relay-log损坏了，导致一部分中继日志没有处理，则自动放弃所有未执行的relay-log，并且重新从master上获取日志，这样就保证了relay-log的完整性。默认情况下该功能是关闭的，将relay_log_recovery的值设置为 1时，可在slave从库上开启该功能，建议开启。</span><br><span class="line">2.7relay_log_space_limit：防止中继日志写满磁盘，这里设置中继日志最大限额。但此设置存在主库崩溃，从库中继日志不全的情况，不到万不得已，不推荐使用；</span><br><span class="line">2.8sync_relay_log：这个参数和sync_binlog是一样的，当设置为1时，slave的I/O线程每次接收到master发送过来的binlog日志都要写入系统缓冲区，然后刷入relay <span class="built_in">log</span>中继日志里，这样是最安全的，因为在崩溃的时候，你最多会丢失一个事务，但会造成磁盘的大量I/O。当设置为0时，并不是马上就刷入中继日志里，而是由操作系统决定何时来写入，虽然安全性降低了，但减少了大量的磁盘I/O操作。这个值默认是0，可动态修改，建议采用默认值。</span><br><span class="line">2.9sync_relay_log_info：这个参数和sync_relay_log参数一样，当设置为1时，slave的I/O线程每次接收到master发送过来的binlog日志都要写入系统缓冲区，然后刷入relay-log.info里，这样是最安全的，因为在崩溃的时候，你最多会丢失一个事务，但会造成磁盘的大量I/O。当设置为0时，并不是马上就刷入relay-log.info里，而是由操作系统决定何时来写入，虽然安全性降低了，但减少了大量的磁盘I/O操作。这个值默认是0，可动态修改，建议采用默认值。</span><br><span class="line">关于binlog和relay <span class="built_in">log</span>的删除方法：</span><br><span class="line">binlog 太多的 解决方法如下：</span><br><span class="line">PURGE MASTER LOGS手动删除用法及示例,MASTER和BINARY是同义词</span><br><span class="line">&gt; PURGE &#123;MASTER | BINARY&#125; LOGS TO <span class="string">&#x27;log_name&#x27;</span></span><br><span class="line">&gt; PURGE &#123;MASTER | BINARY&#125; LOGS BEFORE <span class="string">&#x27;date&#x27;</span></span><br><span class="line">实例：</span><br><span class="line">&gt; PURGE MASTER LOGS TO <span class="string">&#x27;MySQL-bin.010&#x27;</span>; //清除MySQL-bin.010日志</span><br><span class="line">&gt; PURGE MASTER LOGS BEFORE <span class="string">&#x27;2008-06-22 13:00:00&#x27;</span>; //清除2008-06-22 13:00:00前binlog日志 &gt; PURGE MASTER LOGS BEFORE DATE_SUB( NOW( ), INTERVAL 3 DAY); //清除3天前binlog日志BEFORE，变量的<span class="built_in">date</span>自变量可以为<span class="string">&#x27;YYYY-MM-DD hh:mm:ss&#x27;</span>格式。</span><br><span class="line">或者直接：</span><br><span class="line">进入数据库，查看一下当前使用的binlog日志是哪个，除了这个以外的，其它都可以使用<span class="built_in">rm</span> -rf 删除！</span><br><span class="line">relay <span class="built_in">log</span> 可以通过修改一个参数自动删除，前面已经介绍过参数：relay_log_purge=on 即可，自动清空不再需要中继日志。</span><br><span class="line">总结：</span><br><span class="line">mysql数据库的binlog和relay <span class="built_in">log</span>日志有着举足轻重的作用，并且relay <span class="built_in">log</span>仅仅存在于mysql 的slave库，它的作用就是记录slave库中的io进程接收的从主库传过来的binlog,然后等待slave库的sql进程去读取和应用，保证主从同步，但是binlog主库和从库（slave）都可以存在，记录对数据发生或潜在发生更改的SQL语句，并以二进制的形式保存在磁盘，所以可以通过binlog来实时备份和恢复数据库。</span><br><span class="line">参数主要在多主多从的集群架构中开启，否则会导致各从实例无法完整同步集群的全量数据的问题。</span><br><span class="line">多从一从</span><br><span class="line">在多主一从模式下，logs-slave-updates就没那么必须了，各主实例只需维护好自身的 bin-log，从实例则分别读取各主实例的bin-log汇总集群的全量数据，还可以一定层度上提高集群性能。</span><br><span class="line">但为了保证容灾恢复，还是要尽可能的保证logs-slave-updates的开启，否则每台主实例都只有自身数据更新的bin-log，都只能恢复集群数据的一部分，虽然也可以只恢复各自的bin-log再全量同步其他主实例的数据，但相对麻烦些。</span><br><span class="line">logs-slave-updates=1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 表示超过30天的binlog删除,启用二进制日志后保留日志的天数。服务器会自动清理指定天数前的日志文件，如果不设置则会导致服务器空间耗尽。一般设置为7～30天。</span></span><br><span class="line">expire_logs_days = 30</span><br><span class="line"></span><br><span class="line"><span class="comment"># binlog详解</span></span><br><span class="line">一、binlog复制方式</span><br><span class="line">mysql复制主要有三种方式：基于SQL语句的复制(statement-based replication, SBR)，基于行的复制(row-based replication, RBR)，混合模式复制(mixed-based replication, MBR)。对应的，binlog的格式也有三种：STATEMENT，ROW，MIXED。</span><br><span class="line">① STATEMENT模式（SBR）</span><br><span class="line">每一条会修改数据的sql语句会记录到binlog中，slave在复制的时候sql进程会解析成master端执行过的相同的sql在slave库上再次执行。</span><br><span class="line">优点：statement level下的优点首先就是解决了row level下的缺点，不需要每一条sql语句和记录每一行的变化，较少binlog日志量，节约IO，提高性能。因为它只需要记录在master上所执行的语句的细节，以及执行语句时候的上下文信息。</span><br><span class="line">缺点：由于它是记录执行语句，所以，为了让这些语句在slave端也能正确执行，那么它还必须记录每条语句在执行的时候的一些相关信息，也就是上下文信息，来保证所有语句在slave端能够得到和在master端相同的执行结果。由于mysql更新较快，使mysql的赋值遇到了不小的挑战，自然赋值的时候就会涉及到越复杂的内容，bug也就容易出现。在statement level下，目前就已经发现了不少情况会造成mysql的复制出现问题，主要是修改数据的时候使用了某些特定的函数或者功能的时候会出现。比如：<span class="built_in">sleep</span>（）函数在有些版本中就不能正确赋值，在存储过程中使用了last_insert_id（）函数，以及user-defined <span class="built_in">functions</span>(udf)等，可能会使slave和master上得到不一致的<span class="built_in">id</span>等等。由于row level是基于每一行记录的裱花，所以不会出现类似的问题。</span><br><span class="line">总结：</span><br><span class="line">Statement level优点：</span><br><span class="line">1、解决了row level的缺点，不需要记录每一行的变化。</span><br><span class="line">2、日志量少，节约IO，从库应用日志块。</span><br><span class="line">Statement level缺点：一些新功能同步可能会有障碍,比如函数、触发器等。</span><br><span class="line"></span><br><span class="line">② ROW模式（RBR）</span><br><span class="line">不记录每条sql语句的上下文信息，仅需记录哪条数据被修改了，修改成什么样了。而且不会出现某些特定情况下的存储过程、或<span class="keyword">function</span>、或trigger的调用和触发无法被正确复制的问题。缺点是会产生大量的日志，尤其是alter table的时候会让日志暴涨。日志中会记录成每一行数据修改的形式，然后在slave端再对相同的数据进行修改。</span><br><span class="line">优点：在row level的模式下，binlog中可以不记录执行的sql语句的上下文信息，仅仅只需要记录哪一条记录被修改，修改成什么样。所以row level的日志内容会非常清楚的记录每一行数据修改的细节，非常容易理解。而且不会出现某些特定情况下的存储过程，或fuction，以及trigger的调用或处罚无法被正确复制的问题。</span><br><span class="line">缺点：row level模式下，所有的执行语句都会记录到日志中，同时都会以每行记录修改的来记录，这样可能会产生大量的日志内容。</span><br><span class="line">总结：</span><br><span class="line">row level的优点：</span><br><span class="line">1、记录详细</span><br><span class="line">2、解决statement level模式无法解决的复制问题。</span><br><span class="line">row level的缺点：日志量大，因为是按行来拆分。</span><br><span class="line"> </span><br><span class="line">③ MIXED模式（MBR）</span><br><span class="line">以上两种模式的混合使用，一般的复制使用STATEMENT模式保存binlog，对于STATEMENT模式无法复制的操作使用ROW模式保存binlog，MySQL会根据执行的SQL语句选择日志保存方式，也是在statement和row之间选择一种。</span><br><span class="line">新版本中的mysql中对row level模式也做了优化，并不是所有的修改都会以row level来记录，像遇到表结构变更的时候就会以statement模式来记录，如果sql语句确实就是update或者delete等修改数据的语句，那么还是会记录所有行的变更。</span><br><span class="line"> </span><br><span class="line">binlog复制配置</span><br><span class="line"></span><br><span class="line"><span class="comment"># 主从复制事件校验</span></span><br><span class="line">binlog_checksum = none </span><br><span class="line"></span><br><span class="line">在mysql的配置文件my.cnf中，可以通过一下选项配置binglog相关</span><br><span class="line">binlog_format           = MIXED                         //binlog日志格式，mysql默认采用statement，建议使用mixed</span><br><span class="line">log-bin                 = /data/mysql/mysql-bin.log    //binlog日志文件</span><br><span class="line">expire_logs_days        = 7                           //binlog过期清理时间</span><br><span class="line">max_binlog_size         = 100m                       //binlog每个日志文件大小</span><br><span class="line">binlog_cache_size       = 4m                        //binlog缓存大小</span><br><span class="line">max_binlog_cache_size   = 512m                     //最大binlog缓存大小</span><br><span class="line">对于执行的SQL语句中包含now()这样的时间函数，会在日志中产生对应的unix_timestamp()*1000的时间字符串，slave在完成同步时，取用的是sqlEvent发生的时间来保证数据的准确性。另外对于一些功能性函数slave能完成相应的数据同步，而对于上面指定的一些类似于UDF函数，导致Slave无法知晓的情况，则会采用ROW格式存储这些Binlog，以保证产生的Binlog可以供Slave完成数据同步。</span><br><span class="line"></span><br><span class="line">现在来比较以下 SBR 和 RBR 2中模式各自的优缺点：</span><br><span class="line"></span><br><span class="line">SBR 的优点：</span><br><span class="line">历史悠久，技术成熟</span><br><span class="line">binlog文件较小</span><br><span class="line">binlog中包含了所有数据库更改信息，可以据此来审核数据库的安全等情况</span><br><span class="line">binlog可以用于实时的还原，而不仅仅用于复制</span><br><span class="line">主从版本可以不一样，从服务器版本可以比主服务器版本高</span><br><span class="line"></span><br><span class="line">SBR 的缺点：</span><br><span class="line">不是所有的UPDATE语句都能被复制，尤其是包含不确定操作的时候。</span><br><span class="line">调用具有不确定因素的 UDF 时复制也可能出问题</span><br><span class="line">使用以下函数的语句也无法被复制：</span><br><span class="line">* LOAD_FILE()</span><br><span class="line">* UUID()</span><br><span class="line">* USER()</span><br><span class="line">* FOUND_ROWS()</span><br><span class="line">* SYSDATE() (除非启动时启用了 --sysdate-is-now 选项)</span><br><span class="line">INSERT ... SELECT 会产生比 RBR 更多的行级锁</span><br><span class="line">复制需要进行全表扫描(WHERE 语句中没有使用到索引)的 UPDATE 时，需要比 RBR 请求更多的行级锁</span><br><span class="line">对于有 AUTO_INCREMENT 字段的 InnoDB表而言，INSERT 语句会阻塞其他 INSERT 语句</span><br><span class="line">对于一些复杂的语句，在从服务器上的耗资源情况会更严重，而 RBR 模式下，只会对那个发生变化的记录产生影响</span><br><span class="line">存储函数(不是存储过程)在被调用的同时也会执行一次 NOW() 函数，这个可以说是坏事也可能是好事</span><br><span class="line">确定了的 UDF 也需要在从服务器上执行</span><br><span class="line">数据表必须几乎和主服务器保持一致才行，否则可能会导致复制出错</span><br><span class="line">执行复杂语句如果出错的话，会消耗更多资源</span><br><span class="line"></span><br><span class="line">RBR 的优点：</span><br><span class="line">任何情况都可以被复制，这对复制来说是最安全可靠的</span><br><span class="line">和其他大多数数据库系统的复制技术一样</span><br><span class="line">多数情况下，从服务器上的表如果有主键的话，复制就会快了很多</span><br><span class="line">复制以下几种语句时的行锁更少：</span><br><span class="line">* INSERT ... SELECT</span><br><span class="line">* 包含 AUTO_INCREMENT 字段的 INSERT</span><br><span class="line">* 没有附带条件或者并没有修改很多记录的 UPDATE 或 DELETE 语句</span><br><span class="line">执行 INSERT，UPDATE，DELETE 语句时锁更少</span><br><span class="line">从服务器上采用多线程来执行复制成为可能</span><br><span class="line"></span><br><span class="line">RBR 的缺点：</span><br><span class="line">binlog 大了很多</span><br><span class="line">复杂的回滚时 binlog 中会包含大量的数据</span><br><span class="line">主服务器上执行 UPDATE 语句时，所有发生变化的记录都会写到 binlog 中，而 SBR 只会写一次，这会导致频繁发生 binlog 的并发写问题</span><br><span class="line">UDF 产生的大 BLOB 值会导致复制变慢</span><br><span class="line">无法从 binlog 中看到都复制了写什么语句</span><br><span class="line">当在非事务表上执行一段堆积的SQL语句时，最好采用 SBR 模式，否则很容易导致主从服务器的数据不一致情况发生</span><br><span class="line"></span><br><span class="line">另外，针对系统库 mysql 里面的表发生变化时的处理规则如下：</span><br><span class="line">如果是采用 INSERT，UPDATE，DELETE 直接操作表的情况，则日志格式根据 binlog_format 的设定而记录</span><br><span class="line">如果是采用 GRANT，REVOKE，SET PASSWORD 等管理语句来做的话，那么无论如何都采用 SBR 模式记录</span><br><span class="line">注：采用 RBR 模式后，能解决很多原先出现的主键重复问题。</span><br></pre></td></tr></table></figure>

<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># innodb选项</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 说明：该参数可以提升扩展性和刷脏页性能。</span></span><br><span class="line"><span class="comment"># 默认值1，建议值：4-8；并且必须小于innodb_buffer_pool_instances</span></span><br><span class="line">innodb_page_cleaners = 4</span><br><span class="line"></span><br><span class="line"><span class="comment"># 说明:只有当设置 innodb_buffer_pool_size 值大于1G时才有意义，小于1G，instances默认为1，大于1G，instances默认为8</span></span><br><span class="line"><span class="comment"># 但是网络上有评价，最佳性能，每个实例至少1G大小。</span></span><br><span class="line"><span class="comment"># 默认值：1或8，建议值：innodb_buffer_pool_size/innodb_buffer_pool_instances &gt;= 1G</span></span><br><span class="line">innodb_buffer_pool_instances = 1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 说明：mysql 5.7 新特性，defines the chunk size for online InnoDB buffer pool resizing operations.</span></span><br><span class="line"><span class="comment"># 实际缓冲区大小必须为innodb_buffer_pool_chunk_size*innodb_buffer_pool_instances*倍数，取略大于innodb_buffer_pool_size</span></span><br><span class="line"><span class="comment"># 默认值128M，建议值：默认值就好，乱改反而容易出问题，它会影响实际buffer pool大小。</span></span><br><span class="line">innodb_buffer_pool_chunk_size = 128M </span><br><span class="line"></span><br><span class="line"><span class="comment"># 在启动时把热数据加载到内存。默认值为on，不修改</span></span><br><span class="line">innodb_buffer_pool_load_at_startup = 1</span><br><span class="line"><span class="comment"># 在关闭时把热数据dump到本地磁盘。默认值为on，不修改</span></span><br><span class="line">innodb_buffer_pool_dump_at_shutdown = 1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 说明：影响Innodb缓冲区的刷新算法，建议从小到大配置，直到zero free pages；innodb_lru_scan_depth * innodb_buffer_pool_instances defines the amount of work performed by the page cleaner thread each second.</span></span><br><span class="line"><span class="comment"># 默认值1024，建议值: 未知</span></span><br><span class="line">innodb_lru_scan_depth = 1024</span><br><span class="line"></span><br><span class="line"><span class="comment"># 说明：一般8k和16k中选择，8k的话，cpu消耗小些，selcet效率高一点，一般不用改</span></span><br><span class="line"><span class="comment"># 默认值：16k；建议值：不改，</span></span><br><span class="line">innodb_page_size = 16384</span><br><span class="line"></span><br><span class="line"><span class="comment"># 新数据表的默认存储引擎(默认设置是MyISAM)。这项设置还可以通过–default-table-type选项来设置。</span></span><br><span class="line"><span class="comment"># InnoDB为独立表空间模式，每个数据库的每个表都会生成一个数据空间。当删除或截断一个数据库表时，你也可以回收未使用的空间。这样配置的另一个好处是你可以将某些数据库表放在一个单独的存储设备。这可以大大提升你磁盘的I/O负载。</span></span><br><span class="line"><span class="comment"># 独立表空间优点：  </span></span><br><span class="line"><span class="comment"># 1．每个表都有自已独立的表空间。  </span></span><br><span class="line"><span class="comment"># 2．每个表的数据和索引都会存在自已的表空间中。  </span></span><br><span class="line"><span class="comment"># 3．可以实现单表在不同的数据库中移动。  </span></span><br><span class="line"><span class="comment"># 4．空间可以回收（除drop table操作处，表空不能自已回收）  </span></span><br><span class="line"><span class="comment"># 缺点：  </span></span><br><span class="line"><span class="comment"># 单表增加过大，如超过100G  </span></span><br><span class="line"><span class="comment"># 结论：  </span></span><br><span class="line"><span class="comment"># 共享表空间在Insert操作上少有优势。其它都没独立表空间表现好。当启用独立表空间时，请合理调整：innodb_open_files</span></span><br><span class="line">innodb_file_per_table = 1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 说明：限制Innodb能打开的表的数据，如果库里的表特别多的情况，请增加这个。</span></span><br><span class="line"><span class="comment"># 值默认是2000，建议值：参考数据库表总数再进行调整，一般够用不用调整。</span></span><br><span class="line">innodb_open_files = 8192</span><br><span class="line"></span><br><span class="line"><span class="comment"># 说明：The path where InnoDB creates undo tablespaces.通常等于undo log文件的存放目录。</span></span><br><span class="line"><span class="comment"># 默认值./;自行设置</span></span><br><span class="line">innodb_undo_directory = /usr/local/mysql-5.7.21/log  </span><br><span class="line"></span><br><span class="line"><span class="comment"># 说明：The number of undo tablespaces used by InnoDB.等于undo log文件数量。5.7.21后开始弃用</span></span><br><span class="line"><span class="comment"># 默认值为0，建议默认值就好，不用调整了。</span></span><br><span class="line">innodb_undo_tablespaces = 0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 说明：定义undo使用的回滚段数量。5.7.19后弃用</span></span><br><span class="line"><span class="comment"># 默认值128，建议不动，以后弃用了。</span></span><br><span class="line">innodb_undo_logs = 128</span><br><span class="line"></span><br><span class="line"><span class="comment"># 说明：5.7.5后开始使用，在线收缩undo log使用的空间。</span></span><br><span class="line"><span class="comment"># 默认值：关闭，建议值：开启</span></span><br><span class="line">innodb_undo_log_truncate = 1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 说明：结合innodb_undo_log_truncate，实现undo空间收缩功能</span></span><br><span class="line"><span class="comment"># 默认值：1G，建议值，不改。</span></span><br><span class="line">innodb_max_undo_log_size = 1G</span><br><span class="line"></span><br><span class="line"><span class="comment"># InnoDB主目录，所有与InnoDB数据表有关的目录或文件路径都相对于这个路径。在默认的情况下，这个主目录就是MySQL的数据目录。</span></span><br><span class="line">innodb_data_home_dir = /apps/mysql/data</span><br><span class="line"></span><br><span class="line"><span class="comment"># 用来容纳InnoDB为数据表的表空间: 可能涉及一个以上的文件; 每一个表空间文件的最大长度都必须以字节(B)、兆字节(MB)或千兆字节(GB)为单位给出; 表空间文件的名字必须以分号隔开; 最后一个表空间文件还可以带一个autoextend属性和一个最大长度(max:n)。</span></span><br><span class="line">innodb_data_file_path = ibdata1:10M:autoextend</span><br><span class="line"></span><br><span class="line"><span class="comment"># 说明:设置了InnoDB存储引擎用来存放数据字典信息以及一些内部数据结构的内存空间大小,除非你的数据对象及其多，否则一般默认不改。</span></span><br><span class="line"><span class="comment"># innodb_additional_mem_pool_size = 16M</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 用来存放InnoDB日志文件的目录路径(如ib_logfile0、ib_logfile1等)。在默认的情况下，InnoDB驱动程序将使用 MySQL数据目录作为自己保存日志文件的位置。</span></span><br><span class="line">innodb_log_group_home_dir = /apps/mysql/logs</span><br><span class="line"></span><br><span class="line"><span class="comment"># 这个参数是InnoDB存储引擎的核心参数，默认为128KB</span></span><br><span class="line"><span class="comment"># InnoDB使用一个缓冲池来保存索引和原始数据, 不像MyISAM.  </span></span><br><span class="line"><span class="comment"># 这里你设置越大,你在存取表里面数据时所需要的磁盘I/O越少.  </span></span><br><span class="line"><span class="comment"># 在一个独立使用的数据库服务器上,你可以设置这个变量到服务器物理内存大小的60-80%  </span></span><br><span class="line"><span class="comment"># 不要设置过大,否则,由于物理内存的竞争可能导致操作系统的换页颠簸.  </span></span><br><span class="line"><span class="comment"># 注意在32位系统上你每个进程可能被限制在 2-3.5G 用户层面内存限制,  </span></span><br><span class="line"><span class="comment"># 所以不要设置的太高.  </span></span><br><span class="line">innodb_buffer_pool_size = 4G</span><br><span class="line"></span><br><span class="line"><span class="comment"># Innodb使用后台线程处理数据页上的读写 I/O(输入输出)请求,根据你的 CPU 核数来更改,默认是4  </span></span><br><span class="line"><span class="comment"># 注:这两个参数不支持动态改变,需要把该参数加入到my.cnf里，修改完后重启MySQL服务,允许值的范围从1-64</span></span><br><span class="line"><span class="comment"># 建议值：与逻辑cpu数量的一半保持一致。</span></span><br><span class="line">innodb_write_io_threads = 4</span><br><span class="line">innodb_read_io_threads = 4  </span><br><span class="line"></span><br><span class="line"><span class="comment"># 默认设置为0,表示不限制并发数，这里推荐设置为0，更好去发挥CPU多核处理能力，提高并发量</span></span><br><span class="line">innodb_thread_concurrency = 0  </span><br><span class="line"></span><br><span class="line"><span class="comment"># InnoDB中的清除操作是一类定期回收无用数据的操作。在之前的几个版本中，清除操作是主线程的一部分，这意味着运行时它可能会堵塞其它的数据库操作。  </span></span><br><span class="line"><span class="comment"># 从MySQL5.5.X版本开始，该操作运行于独立的线程中,并支持更多的并发数。</span></span><br><span class="line"><span class="comment"># 用户可通过设置innodb_purge_threads配置参数来选择清除操作是否使用单独线程,默认情况下参数设置为0(不使用单独线程),</span></span><br><span class="line"><span class="comment"># 设置为 1 时表示使用单独的清除线程。建议为1</span></span><br><span class="line"><span class="comment"># mysql 5.5之后，支持多线程清除操作。</span></span><br><span class="line">innodb_purge_threads = 1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 说明：mysql缓冲区分为new blocks和old blocks；此参数表示old blocks占比；</span></span><br><span class="line"><span class="comment"># 默认值：37，建议值，一般不动</span></span><br><span class="line">innodb_old_blocks_pct = 37</span><br><span class="line"></span><br><span class="line"><span class="comment"># 说明：新数据被载入缓冲池，进入old pages链区，当1秒后再次访问，则提升进入new pages链区。</span></span><br><span class="line"><span class="comment"># 默认值：1000</span></span><br><span class="line">innodb_old_blocks_time=1000</span><br><span class="line"></span><br><span class="line"><span class="comment"># 说明：开启异步io，可以提高并发性，默认开启。</span></span><br><span class="line"><span class="comment"># 默认值为1，建议不动</span></span><br><span class="line">innodb_use_native_aio = 1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 事务日志文件写操作缓存区的最大长度(默认设置是1MB)。更大的设置可以提高性能，但也会增加恢复故障数据库所需的时间</span></span><br><span class="line">innodb_log_file_size = 1G  </span><br><span class="line"></span><br><span class="line"><span class="comment"># 为提高性能，MySQL可以以循环方式将日志文件写到多个文件。默认值2，推荐设置为3</span></span><br><span class="line">innodb_log_files_in_group = 3 </span><br><span class="line"></span><br><span class="line"><span class="comment"># innodb主线程刷新缓存池中的数据，使脏数据比例小于90%</span></span><br><span class="line">innodb_max_dirty_pages_pct = 90 </span><br><span class="line"></span><br><span class="line"><span class="comment"># 从MySQL5.5.X版本开始，你可以开启InnoDB严格检查模式，尤其采用了页数据压缩功能后，最好是开启该功能。开启此功能后，当创建表（CREATE TABLE）、更改表（ALTER TABLE）和创建索引（CREATE INDEX）语句时，如果写法有错误，不会有警告信息，而是直接抛出错误，这样就可直接将问题扼杀在摇篮里。</span></span><br><span class="line"><span class="comment"># 开启InnoDB严格检查模式涉及的参数是innodb_strict_mode，默认为OFF，支持动态开启</span></span><br><span class="line">innodb_strict_mode = 0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 此参数确定些日志文件所用的内存大小，以M为单位。缓冲区更大能提高性能，但意外的故障将会丢失数据。事务日志所使用的缓存区。InnoDB在写事务日志的时候为了提高性能，先将信息写入Innodb Log Buffer中，当满足innodb_flush_log_trx_commit参数所设置的相应条件（或者日志缓冲区写满）时，再将日志写到文件（或者同步到磁盘）中。可以通过innodb_log_buffer_size参数设置其可以使用的最大内存空间。默认是8MB，一般为16～64MB即可。</span></span><br><span class="line">innodb_log_buffer_size = 64M</span><br><span class="line"></span><br><span class="line"><span class="comment"># 说明：可以控制log从系统buffer刷入磁盘文件的刷新频率，增大可减轻系统负荷</span></span><br><span class="line"><span class="comment"># 默认值是1；建议值不改。系统性能一般够用。</span></span><br><span class="line">innodb_flush_log_at_timeout = 1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 这个选项决定着什么时候把日志信息写入日志文件以及什么时候把这些文件物理地写(术语称为”同步”)到硬盘上。</span></span><br><span class="line"><span class="comment"># 0: 如果innodb_flush_log_at_trx_commit的值为0,log buffer每秒就会被刷写日志文件到磁盘，提交事务的时候不做任何操作（执行是由mysql的master thread线程来执行的。  </span></span><br><span class="line"><span class="comment"># 主线程中每秒会将重做日志缓冲写入磁盘的重做日志文件(REDO LOG)中。不论事务是否已经提交）默认的日志文件是ib_logfile0,ib_logfile1  </span></span><br><span class="line"><span class="comment"># 1: 当设为默认值1的时候，每次提交事务的时候，都会将log buffer刷写到日志。  </span></span><br><span class="line"><span class="comment"># 2: 如果设为2,每次提交事务都会写日志，但并不会执行刷的操作。每秒定时会刷到日志文件。要注意的是，并不能保证100%每秒一定都会刷到磁盘，这要取决于进程的调度。  </span></span><br><span class="line"><span class="comment"># 每次事务提交的时候将数据写入事务日志，而这里的写入仅是调用了文件系统的写入操作，而文件系统是有 缓存的，所以这个写入并不能保证数据已经写入到物理磁盘</span></span><br><span class="line"><span class="comment"># 默认值1是为了保证完整的ACID。当然，你可以将这个配置项设为1以外的值来换取更高的性能，但是在系统崩溃的时候，你将会丢失1秒的数据。  </span></span><br><span class="line"><span class="comment"># 设为0的话，mysqld进程崩溃的时候，就会丢失最后1秒的事务。设为2,只有在操作系统崩溃或者断电的时候才会丢失最后1秒的数据。InnoDB在做恢复的时候会忽略这个值。  </span></span><br><span class="line"><span class="comment"># 总结 </span></span><br><span class="line"><span class="comment"># 设为1当然是最安全的，但性能页是最差的（相对其他两个参数而言，但不是不能接受）。如果对数据一致性和完整性要求不高，完全可以设为2，如果只最求性能，例如高并发写的日志服务器，设为0来获得更高性能</span></span><br><span class="line">innodb_flush_log_at_trx_commit = 1  </span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果某个事务在等待n秒(s)后还没有获得所需要的资源，就使用ROLLBACK命令放弃这个事务。这项设置对于发现和处理未能被InnoDB数据表驱动 程序识别出来的死锁条件有着重要的意义。</span></span><br><span class="line"><span class="comment"># InnoDB事务在被回滚之前可以等待一个锁定的超时秒数。InnoDB在它自己的锁定表中自动检测事务死锁并且回滚事务。InnoDB用LOCK TABLES语句注意到锁定设置。默认值是50秒</span></span><br><span class="line">innodb_lock_wait_timeout = 50</span><br><span class="line"></span><br><span class="line"><span class="comment"># 说明：设置了Mysql后台任务（例如页刷新和merge dadta from buffer pool）每秒io操作的上限。</span></span><br><span class="line"><span class="comment"># 默认值：200，建议值：方法一，单盘sata设100，sas10，raid10设200，ssd设2000，fushion-io设50000；方法二，通过测试工具获得磁盘io性能后，设置IOPS数值/2。</span></span><br><span class="line">innodb_io_capacity = 2000</span><br><span class="line"></span><br><span class="line"><span class="comment"># 说明：该参数是所有缓冲区线程io操作的总上限。</span></span><br><span class="line"><span class="comment"># 默认值：innodb_io_capacity的两倍。建议值：例如用iometer测试后的iops数值就好</span></span><br><span class="line">innodb_io_capacity_max = 4000</span><br><span class="line"></span><br><span class="line"><span class="comment"># 说明：控制着innodb数据文件及redo log的打开、刷写模式，三种模式：fdatasync(默认)，O_DSYNC，O_DIRECT</span></span><br><span class="line"><span class="comment"># fdatasync：数据文件，buffer pool-&gt;os buffer-&gt;磁盘；日志文件，buffer pool-&gt;os buffer-&gt;磁盘；</span></span><br><span class="line"><span class="comment"># O_DSYNC：  数据文件，buffer pool-&gt;os buffer-&gt;磁盘；日志文件，buffer pool-&gt;磁盘；</span></span><br><span class="line"><span class="comment"># O_DIRECT： 数据文件，buffer pool-&gt;磁盘；           日志文件，buffer pool-&gt;os buffer-&gt;磁盘；</span></span><br><span class="line"><span class="comment"># 默认值为空，建议值：使用SAN或者raid，建议用O_DIRECT，不懂测试的话，默认生产上使用O_DIRECT</span></span><br><span class="line">innodb_flush_method = O_DIRECT</span><br><span class="line"></span><br><span class="line">innodb_force_recovery = 1</span><br><span class="line">为了验证数据库页面是否损坏，可以使用SELECT ... INTO OUTFILE从数据库导出数据表。一般情况下以这种方式获得的数据大多数是完整的。但如果是损坏严重的数据可能导致SELECT * FROM tbl_name语句或InnoDB后台操作崩溃或断言，甚至导致InnoDB回滚恢复崩溃。在这种情况下，可以使用innodb_force_recovery选项让InnoDB存储引擎强制启动，同时防止后台操作运行，这样可以转储表了。</span><br><span class="line">注意</span><br><span class="line">在进行这个操作之前，务必备份数据库。</span><br><span class="line">在紧急情况下，为了可以启动InnoDB并转储表，必须将innodb_force_recovery设置为大于0的值。</span><br><span class="line">4或更高的值可能会永久损坏数据文件。在测试数据库的单独物理副本上操作成功后，才能在生产服务器使用4或更高版本的innodb_force_recovery设置。当InnoDB强制恢复时，应该始终以innodb_force_recovery = 1开始，并根据需要逐渐增加值。为什么从1开始呢，因为1是最保险的，可以看后面对不同值的解释</span><br><span class="line">innodb_force_recovery默认为0（正常启动）。 innodb_force_recovery的非零值是从1到6。较大的值包括较小值的功能。例如，3包括1和2的所有功能。</span><br><span class="line">innodb_force_recovery值为3或更小时，只有损坏的单个页面上的某些数据丢失。 4或更高的值是危险的，因为数据文件可能永久损坏。6不建议使用，因为数据库页面处于过时状态，这陆续可能在B树和其他数据库结构中引入更多的损坏。</span><br><span class="line">为了安全起见，InnoDB在innodb_force_recovery大于0时会阻止INSERT，UPDATE或DELETE操作。</span><br><span class="line">    【Mysql 5.7】</span><br><span class="line">    在innodb只读模式下innodb_force_recovery可以设置为4或更大值</span><br><span class="line">1 (SRV_FORCE_IGNORE_CORRUPT)</span><br><span class="line">当检测到损坏的页面时继续让服务器运行。 导出表时尝试SELECT * FROM tbl_name跳过损坏的索引记录和页面。</span><br><span class="line"></span><br><span class="line">2 (SRV_FORCE_NO_BACKGROUND)</span><br><span class="line">阻止主线程和任何废止线程运行。 设置为2可以在废止操作期间阻止崩溃。</span><br><span class="line"></span><br><span class="line">3 (SRV_FORCE_NO_TRX_UNDO)</span><br><span class="line">崩溃后恢复时不执行事务回滚</span><br><span class="line"></span><br><span class="line">4 (SRV_FORCE_NO_IBUF_MERGE)</span><br><span class="line">阻止写入缓冲区合并操作。 如果会造成事故，不做写入，不计算表统计。 此类型可能会永久损坏数据文件。 需要删除并重新创建所有辅助索引。innoDB设置为只读模式【Mysql 5.7】</span><br><span class="line"></span><br><span class="line">5 (SRV_FORCE_NO_UNDO_LOG_SCAN)</span><br><span class="line">启动数据库时不查看undo日志：InnoDB会将不完整的事务视为已提交。 设置为此值可能会永久损坏数据文件。innoDB设置为只读模式【Mysql 5.7】</span><br><span class="line"></span><br><span class="line">6 (SRV_FORCE_NO_LOG_REDO)</span><br><span class="line">无法将与恢复相关联的重做日志恢复。设置此值可能会永久损坏数据文件。让数据库页面处于过时状态，从而可能会在B树和其他数据库结构中引入更多的损坏。innoDB设置为只读模式【Mysql 5.7】</span><br><span class="line">即使开启了innodb_force_recovery设置也可以使用SELECT from tables导出表数据或者删除、创建表。如果知道在回滚时会引起崩溃，可以直接删除这个表。</span><br><span class="line"></span><br><span class="line">    【Mysql 5.7】</span><br><span class="line">    可以使用 SELECT from tables来导出表数据。innodb_force_recovery设置为3及以下时可以创建和删除表。当然如果mysql版本低于5.7.18，innodb_force_recovery设置为3以上也是可以删除表的，从5.7.18起被禁止了。</span><br><span class="line"></span><br><span class="line">您还可以使用它来停止由大量导入失败导致的失控回滚或ALTER TABLE操作：</span><br><span class="line">杀掉mysql进程并将innodb_force_recovery设置为3，让数据库升级而不进行回滚，然后删除导致失控回滚的表。</span><br><span class="line">如果表数据中的损坏而导出不了，可以使用ORDER BY primary_key DESC子句的查询将损坏部分后的数据导出来。</span><br><span class="line">如果innodb_force_recovery必须要设置很大的值才能启动innodb，这可能会导致复杂查询（包含WHERE，ORDER BY或其他子句的查询）失败。这时候只能运行基本的SELECT * FROM t查询。</span><br></pre></td></tr></table></figure>
      </div>
      
        <div class="prev-or-next">
          <div class="post-foot-next">
            
              <a href="/posts/b97760d.html" target="_self">
                <i class="iconfont icon-chevronleft"></i>
                <span>上一页</span>
              </a>
            
          </div>
          <div class="post-attach">
            <span class="post-pubtime">
              <i class="iconfont icon-updatetime" title="更新时间"></i>
              2017-11-07 01:56:27
            </span>
            
                  <span class="post-categories">
                    <i class="iconfont icon-bookmark" title="分类"></i>
                    
                    <span class="span--category">
                      <a href="/categories/%E5%90%8E%E7%AB%AF/" title="后端">
                        <b>#</b> 后端
                      </a>
                    </span>
                    
                    <span class="span--category">
                      <a href="/categories/%E5%90%8E%E7%AB%AF/mysql/" title="mysql">
                        <b>#</b> mysql
                      </a>
                    </span>
                    
                  </span>
              
                  <span class="post-tags">
                    <i class="iconfont icon-tags" title="标签"></i>
                    
                    <span class="span--tag">
                      <a href="/tags/%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6/" title="配置文件">
                        <b>#</b> 配置文件
                      </a>
                    </span>
                    
                  </span>
              
          </div>
          <div class="post-foot-prev">
            
              <a href="/posts/b612af2c.html" target="_self">
                <span>下一页</span>
                <i class="iconfont icon-chevronright"></i>
              </a>
            
          </div>
        </div>
      
    </div>
    

    
  </div>


        
<div class="footer">
  <div class="social">
    <ul>
      
        <li>
          <a title="github" target="_blank" rel="noopener" href="https://github.com/thiscat/">
            <i class="iconfont icon-github"></i>
          </a>
        </li>
      
        <li>
          <a title="gitee" target="_blank" rel="noopener" href="https://gitee.com/thiscat/">
            <i class="iconfont icon-github"></i>
          </a>
        </li>
      
    </ul>
  </div>
  
    
    <div class="footer-more">
      
        <a target="_blank" rel="noopener" href="https://github.com/zchengsite/hexo-theme-oranges">Theme by Oranges | Powered by Hexo</a>
        
    </div>
  
    
    <div class="footer-more">
      
        <a target="_blank" rel="noopener" href="https://beian.miit.gov.cn/">闽ICP备2023002086号-1</a>
        
    </div>
  
</div>

      </div>

      <div class="tools-bar">
        <div class="back-to-top tools-bar-item hidden">
  <a href="javascript: void(0)">
    <i class="iconfont icon-chevronup"></i>
  </a>
</div>


<script src="/js/backtotop.js"></script>



        
  <div class="search-icon tools-bar-item" id="search-icon">
    <a href="javascript: void(0)">
      <i class="iconfont icon-search"></i>
    </a>
  </div>

  <div class="search-overlay hidden">
    <div class="search-content" tabindex="0">
      <div class="search-title">
        <span class="search-icon-input">
          <a href="javascript: void(0)">
            <i class="iconfont icon-search"></i>
          </a>
        </span>
        
          <input type="text" class="search-input" id="search-input" placeholder="搜索...">
        
        <span class="search-close-icon" id="search-close-icon">
          <a href="javascript: void(0)">
            <i class="iconfont icon-close"></i>
          </a>
        </span>
      </div>
      <div class="search-result" id="search-result"></div>
    </div>
  </div>

  <script type="text/javascript">
    var inputArea = document.querySelector("#search-input")
    var searchOverlayArea = document.querySelector(".search-overlay")

    inputArea.onclick = function() {
      getSearchFile()
      this.onclick = null
    }

    inputArea.onkeydown = function() {
      if(event.keyCode == 13)
        return false
    }

    function openOrHideSearchContent() {
      let isHidden = searchOverlayArea.classList.contains('hidden')
      if (isHidden) {
        searchOverlayArea.classList.remove('hidden')
        document.body.classList.add('hidden')
        // inputArea.focus()
      } else {
        searchOverlayArea.classList.add('hidden')
        document.body.classList.remove('hidden')
      }
    }

    function blurSearchContent(e) {
      if (e.target === searchOverlayArea) {
        openOrHideSearchContent()
      }
    }

    document.querySelector("#search-icon").addEventListener("click", openOrHideSearchContent, false)
    document.querySelector("#search-close-icon").addEventListener("click", openOrHideSearchContent, false)
    searchOverlayArea.addEventListener("click", blurSearchContent, false)

    var searchFunc = function (path, search_id, content_id) {
      'use strict';
      var $input = document.getElementById(search_id);
      var $resultContent = document.getElementById(content_id);
      $resultContent.innerHTML = "<ul><span class='local-search-empty'>首次搜索，正在载入索引文件，请稍后……<span></ul>";
      $.ajax({
        // 0x01. load xml file
        url: path,
        dataType: "xml",
        success: function (xmlResponse) {
          // 0x02. parse xml file
          var datas = $("entry", xmlResponse).map(function () {
            return {
              title: $("title", this).text(),
              content: $("content", this).text(),
              url: $("url", this).text()
            };
          }).get();
          $resultContent.innerHTML = "";

          $input.addEventListener('input', function () {
            // 0x03. parse query to keywords list
            var str = '<ul class=\"search-result-list\">';
            var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
            $resultContent.innerHTML = "";
            if (this.value.trim().length <= 0) {
              return;
            }
            // 0x04. perform local searching
            datas.forEach(function (data) {
              var isMatch = true;
              var content_index = [];
              if (!data.title || data.title.trim() === '') {
                data.title = "Untitled";
              }
              var orig_data_title = data.title.trim();
              var data_title = orig_data_title.toLowerCase();
              var orig_data_content = data.content.trim().replace(/<[^>]+>/g, "");
              var data_content = orig_data_content.toLowerCase();
              var data_url = data.url;
              var index_title = -1;
              var index_content = -1;
              var first_occur = -1;
              // only match artiles with not empty contents
              if (data_content !== '') {
                keywords.forEach(function (keyword, i) {
                  index_title = data_title.indexOf(keyword);
                  index_content = data_content.indexOf(keyword);

                  if (index_title < 0 && index_content < 0) {
                    isMatch = false;
                  } else {
                    if (index_content < 0) {
                      index_content = 0;
                    }
                    if (i == 0) {
                      first_occur = index_content;
                    }
                    // content_index.push({index_content:index_content, keyword_len:keyword_len});
                  }
                });
              } else {
                isMatch = false;
              }
              // 0x05. show search results
              if (isMatch) {
                str += "<li><a href='" + data_url + "' class='search-result-title'>" + orig_data_title + "</a>";
                var content = orig_data_content;
                if (first_occur >= 0) {
                  // cut out 100 characters
                  var start = first_occur - 20;
                  var end = first_occur + 80;

                  if (start < 0) {
                    start = 0;
                  }

                  if (start == 0) {
                    end = 100;
                  }

                  if (end > content.length) {
                    end = content.length;
                  }

                  var match_content = content.substr(start, end);

                  // highlight all keywords
                  keywords.forEach(function (keyword) {
                    var regS = new RegExp(keyword, "gi");
                    match_content = match_content.replace(regS, "<span class=\"search-keyword\">" + keyword + "</span>");
                  });

                  str += "<p class=\"search-result-abstract\">" + match_content + "...</p>"
                }
                str += "</li>";
              }
            });
            str += "</ul>";
            if (str.indexOf('<li>') === -1) {
              return $resultContent.innerHTML = "<ul><span class='local-search-empty'>没有找到内容，请尝试更换检索词。<span></ul>";
            }
            $resultContent.innerHTML = str;
          });
        },
        error: function(xhr, status, error) {
          $resultContent.innerHTML = ""
          if (xhr.status === 404) {
            $resultContent.innerHTML = "<ul><span class='local-search-empty'>未找到search.xml文件，具体请参考：<a href='https://github.com/zchengsite/hexo-theme-oranges#configuration' target='_black'>configuration</a><span></ul>";
          } else {
            $resultContent.innerHTML = "<ul><span class='local-search-empty'>请求失败，尝试重新刷新页面或稍后重试。<span></ul>";
          }
        }
      });
      $(document).on('click', '#search-close-icon', function() {
        $('#search-input').val('');
        $('#search-result').html('');
      });
    }

    var getSearchFile = function() {
        var path = "/search.xml";
        searchFunc(path, 'search-input', 'search-result');
    }
  </script>




        
  <div class="tools-bar-item theme-icon" id="switch-color-scheme">
    <a href="javascript: void(0)">
      <i id="theme-icon" class="iconfont icon-moon"></i>
    </a>
  </div>

  
<script src="/js/colorscheme.js"></script>





        
  
    <div class="share-icon tools-bar-item">
      <a href="javascript: void(0)" id="share-icon">
        <i class="iconfont iconshare"></i>
      </a>
      <div class="share-content hidden">
        
          <a class="share-item" href="https://twitter.com/intent/tweet?text=' + mysql%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6 + '&url=' + https%3A%2F%2Finspiring-starlight-8a2c35.netlify.app%2Fposts%2Fffed214c.html + '" target="_blank" title="Twitter">
            <i class="iconfont icon-twitter"></i>
          </a>
        
        
          <a class="share-item" href="https://www.facebook.com/sharer.php?u=https://inspiring-starlight-8a2c35.netlify.app/posts/ffed214c.html" target="_blank" title="Facebook">
            <i class="iconfont icon-facebooksquare"></i>
          </a>
        
      </div>
    </div>
  
  
<script src="/js/shares.js"></script>



      </div>
    </div>
  </body>
</html>
